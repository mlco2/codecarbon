{"config":{"separator":"[\\s\\-_,:!=\\[\\]()\\\\\"`/]+|\\.(?!\\d)"},"items":[{"location":"","level":1,"title":"Track &amp; reduce CO‚ÇÇ emissions from your local computing","text":"<p>AI can benefit society in many ways, but given the energy needed to support the computing behind AI, these benefits can come at a high environmental price. Use CodeCarbon to track and reduce your CO‚ÇÇ output from code running on your own hardware. For tracking emissions from remote GenAI API calls (OpenAI, Anthropic, etc.), see EcoLogits.</p> <p>Get Started ‚Üí</p>","path":["Introduction","Track &amp; reduce CO‚ÇÇ emissions from your local computing"],"tags":[]},{"location":"#what-we-are","level":2,"title":"What we are","text":"<ul> <li>A lightweight, easy to use Python library ‚Äì Simple API to track emissions</li> <li>Open source, free &amp; community driven ‚Äì Built by and for the community</li> <li>Effective visual outputs ‚Äì Put emissions in context with real-world equivalents</li> </ul>","path":["Introduction","Track &amp; reduce CO‚ÇÇ emissions from your local computing"],"tags":[]},{"location":"#computer-emits-co2-we-started-measuring-how-much","level":2,"title":"Computer emits CO‚ÇÇ. We started measuring how much","text":"<p>A single datacenter can consume large amounts of energy to run computing code. An innovative new tracking tool is designed to measure the climate impact of artificial intelligence.</p> <p>Kana Lottick, Silvia Susai, Sorelle Friedler, and Jonathan Wilson. Energy Usage Reports: Environmental awareness as part of algorithmic accountability. NeurIPS Workshop on Tackling Climate Change with Machine Learning, 2019.</p>","path":["Introduction","Track &amp; reduce CO‚ÇÇ emissions from your local computing"],"tags":[]},{"location":"#how-it-works","level":2,"title":"How it works","text":"<ol> <li>Download package ‚Äì <code>pip install codecarbon</code></li> <li>Embed the code ‚Äì Add a few lines to your script</li> <li>Run and track ‚Äì Emissions are measured automatically</li> <li>Visualize results ‚Äì See your impact in context</li> </ol>","path":["Introduction","Track &amp; reduce CO‚ÇÇ emissions from your local computing"],"tags":[]},{"location":"#seamless-integration","level":2,"title":"Seamless integration","text":"<p>Only a few lines of code:</p> <pre><code>from codecarbon import EmissionsTracker\n\ntracker = EmissionsTracker()\ntracker.start()\n\n# Your code here\n\nemissions = tracker.stop()\nprint(f\"Emissions: {emissions} kg CO‚ÇÇ\")\n</code></pre>","path":["Introduction","Track &amp; reduce CO‚ÇÇ emissions from your local computing"],"tags":[]},{"location":"#quick-links","level":2,"title":"Quick links","text":"Section Description When to use CodeCarbon Local vs remote: CodeCarbon vs EcoLogits Installation Get started with CodeCarbon Usage Learn how to use CodeCarbon API Reference Full API documentation Examples Example usage patterns Methodology How emissions are calculated","path":["Introduction","Track &amp; reduce CO‚ÇÇ emissions from your local computing"],"tags":[]},{"location":"getting-started/advanced_installation/","level":1,"title":"Advanced Installation","text":"","path":["Getting Started","Advanced Installation"],"tags":[]},{"location":"getting-started/advanced_installation/#install-codecarbon-as-a-linux-service","level":2,"title":"Install CodeCarbon as a Linux service","text":"<p>To install CodeCarbon as a Linux service, follow the instructions below. It works on Ubuntu or other Debian-based systems using systemd.</p> <p>Create a dedicated user:</p> <pre><code>sudo useradd -r -s /bin/false codecarbon\n</code></pre> <p>Create a directory for the CodeCarbon service:</p> <pre><code>sudo mkdir /opt/codecarbon\n</code></pre> <p>Change the ownership of the directory to the user created above:</p> <pre><code>sudo chown codecarbon:codecarbon /opt/codecarbon\n</code></pre> <p>Create a virtual environment for CodeCarbon :</p> <pre><code>sudo apt install python3-venv\nsudo -u codecarbon python3 -m venv /opt/codecarbon/.venv\n</code></pre> <p>Install CodeCarbon in the virtual environment:</p> <pre><code>sudo -u codecarbon /opt/codecarbon/.venv/bin/pip install codecarbon\n</code></pre> <p>Go to https://dashboard.codecarbon.io/ and create an account to get your API key.</p> <p>Configure CodeCarbon:</p> <pre><code>sudo -u codecarbon /opt/codecarbon/.venv/bin/codecarbon login\n</code></pre> <p>Create a systemd service file:</p> <pre><code>sudo tee /etc/systemd/system/codecarbon.service &lt;&lt;EOF\n[Unit]\nDescription=CodeCarbon service\nAfter=network.target\n\n[Service]\nUser=codecarbon\nGroup=codecarbon\nWorkingDirectory=/opt/codecarbon\nExecStart=/opt/codecarbon/.venv/bin/codecarbon monitor\nRestart=always\n\n[Install]\nWantedBy=multi-user.target\nEOF\n</code></pre> <p>Give permissions to the <code>codecarbon</code> group to read the RAPL (Running Average Power Limit) information:</p> <pre><code>sudo chown -R root:codecarbon /sys/class/powercap/intel-rapl/*\nsudo chmod g+r -R /sys/class/powercap/intel-rapl/*\n\nsudo apt install sysfsutils\necho \"mode class/powercap/intel-rapl:0/energy_uj = 0440\" &gt;&gt; /etc/sysfs.conf\necho \"owner class/powercap/intel-rapl:0/energy_uj = root:codecarbon\" &gt;&gt; /etc/sysfs.conf\n</code></pre> <p>Create the configuration file for CodeCarbon:</p> <pre><code>sudo tee /opt/codecarbon/.codecarbon.config &lt;&lt;EOF\n[codecarbon]\napi_endpoint = https://api.codecarbon.io\norganization_id = &lt;organization_id&gt;\nproject_id = &lt;project_id&gt;\nexperiment_id = &lt;experiment_id&gt;\napi_key = &lt;api_key&gt;\n# Verbose logging\nlog_level=WARNING\n# Measure power every 30 seconds\nmeasure_power_secs=30\n# Send measure to API every 5 minutes (10*30 seconds)\napi_call_interval=10\nEOF\n</code></pre> <p>Enable and start the service:</p> <pre><code>sudo systemctl enable codecarbon\nsudo systemctl start codecarbon\n</code></pre> <p>Check the traces of the service:</p> <pre><code>journalctl -u codecarbon\n</code></pre> <p>You are done, CodeCarbon is now running as a service on your machine.</p> <p>Wait 5 minutes for the first measure to be send to the dashboard at https://dashboard.codecarbon.io/.</p>","path":["Getting Started","Advanced Installation"],"tags":[]},{"location":"getting-started/advanced_installation/#deploy-codecarbon-cli-as-a-service-using-ansible","level":2,"title":"Deploy CodeCarbon CLI as a Service using Ansible","text":"<p>This section describes how to deploy CodeCarbon as a system service using Ansible automation.</p> <p>It automate the manual installation done in the previous chapter.</p>","path":["Getting Started","Advanced Installation"],"tags":[]},{"location":"getting-started/advanced_installation/#what-the-playbook-does","level":3,"title":"What the Playbook Does","text":"<p>The Ansible playbook automates the following tasks:</p> <ul> <li>Creates a dedicated system user and group for CodeCarbon</li> <li>Sets up a Python virtual environment</li> <li>Installs CodeCarbon package</li> <li>Configures RAPL permissions for power measurements</li> <li>Creates and configures the systemd service</li> <li>Sets up the CodeCarbon configuration file</li> <li>Starts and enables the service</li> </ul>","path":["Getting Started","Advanced Installation"],"tags":[]},{"location":"getting-started/advanced_installation/#prerequisites","level":3,"title":"Prerequisites","text":"<ul> <li>Ansible installed on your machine</li> <li>Debian-based target system(s)</li> <li>SSH access to target system(s)</li> <li>CodeCarbon API credentials from the dashboard</li> </ul>","path":["Getting Started","Advanced Installation"],"tags":[]},{"location":"getting-started/advanced_installation/#directory-structure","level":3,"title":"Directory Structure","text":"<pre><code>codecarbon/deploy/ansible/codecarbon_cli_as_a_service/\n‚îú‚îÄ‚îÄ hosts\n‚îú‚îÄ‚îÄ tasks\n‚îÇ   ‚îú‚îÄ‚îÄ install_codecarbon.yml\n‚îÇ   ‚îú‚îÄ‚îÄ main.yml\n‚îÇ   ‚îú‚îÄ‚îÄ rapl.yml\n‚îÇ   ‚îî‚îÄ‚îÄ systemd_service.yml\n‚îú‚îÄ‚îÄ templates\n‚îÇ   ‚îú‚îÄ‚îÄ codecarbon.config.j2\n‚îÇ   ‚îî‚îÄ‚îÄ systemd_service.j2\n‚îî‚îÄ‚îÄ vars\n    ‚îî‚îÄ‚îÄ main.yml\n</code></pre>","path":["Getting Started","Advanced Installation"],"tags":[]},{"location":"getting-started/advanced_installation/#quick-start","level":3,"title":"Quick Start","text":"<ol> <li> <p>Set the the target to install in <code>hosts</code>:</p> <pre><code>yourservername.yourdomain.com   hostname=yourservername ansible_user=root ansible_ssh_private_key_file=~/.ssh/id_ed25519\n</code></pre> </li> <li> <p>Update the variables in <code>vars/main.yml</code> with your configuration:</p> <pre><code>organization_id: your_org_id\nproject_id: your_project_id\nexperiment_id: your_experiment_id\napi_key: your_api_key\n</code></pre> </li> <li> <p>Run the playbook:</p> <pre><code>ansible-playbook -i hosts tasks/main.yml\n</code></pre> </li> </ol>","path":["Getting Started","Advanced Installation"],"tags":[]},{"location":"getting-started/api/","level":1,"title":"CodeCarbon API","text":"<p>API mode</p> <p>This mode uses the CodeCarbon API to upload the timeseries of your emissions on a central server.</p> <p>Thanks to CleverCloud the use of API is free as soon as it remains under certain limits.</p> <p></p> <p></p> <p>Before using it, you need to create an account on the CodeCarbon dashboard</p> <p>Then login from your terminal:</p> <pre><code>codecarbon login\n</code></pre> <p>It will create an experiment_id for the default project and save it to <code>codecarbon.config</code></p> <p>Then you can tell CodeCarbon to monitor your machine:</p> <pre><code>codecarbon monitor\n</code></pre> <p>Or use the API in your code:</p> <pre><code>from codecarbon import track_emissions\n\n@track_emissions(save_to_api=True)\ndef train_model():\n    # GPU intensive training code  goes here\n\nif __name__ ==\"__main__\":\n    train_model()\n</code></pre> <p>More options could be specified in <code>@track_emissions</code> or in <code>.codecarbon.config</code></p> <p>The CodeCarbon dashboard use CodeCarbon API to get the data</p> <p>The API do not have a nice web interface to create your own organization and project, you have to use OpenAPI interface for that.</p> <p>And so on for your team, project and experiment.</p> <p>You then have to set your experiment id in CodeCarbon, with two options:</p> <p>In the code:</p> <pre><code>from codecarbon import track_emissions\n\n@track_emissions(\n    measure_power_secs=30,\n    api_call_interval=4,\n    experiment_id=\"your experiment id\",\n    save_to_api=True,\n)\ndef train_model():\n    ...\n</code></pre> <p>Or in the config file <code>.codecarbon.config</code>:</p> <pre><code>[codecarbon]\nexperiment_id = your experiment id\nsave_to_api = true\n</code></pre>","path":["Getting Started","CodeCarbon API"],"tags":[]},{"location":"getting-started/comet/","level":1,"title":"Comet Integration","text":"<p>CodeCarbon can be automatically integrated with Comet for experiment tracking and visualization. Comet provides data scientists with powerful tools to track, compare, explain, and reproduce their experiments. Now, with CodeCarbon you can easily track the carbon footprint of your jobs along with your training metrics, hyperparameters, dataset samples, artifacts, and more.</p> <p></p> <p>To get started with the Comet-CodeCarbon integration, make sure you have comet-ml installed:</p> <pre><code>pip install comet_ml&gt;=3.2.2\n</code></pre> <p>Go to Comet's website and create a free account. From your account settings page, copy your personal API key.</p> <p>In the mnist-comet.py example file, replace the placeholder code with your API key:</p> <pre><code>experiment = Experiment(api_key=\"YOUR API KEY\")\n</code></pre> <p>Run your experiment and click on the link in stdout to be taken back to the Comet UI. You'll automatically see your metrics, hyperparameters, graph definition, system and environment details, and more.</p> <p>Comet will automatically create an <code>EmissionsTracker</code> object from the <code>codecarbon</code> package when your code runs. To visualize the carbon footprint of your experiment, go to the <code>Panel</code> tab in the left sidebar and click <code>Add Panel</code>.</p> <p>From the Panel Gallery click the <code>Public</code> tab and search for <code>CodeCarbon Footprint</code>. Once you've found it, add it to your Experiment.</p> <p></p> <p>Now back in the <code>Panels</code> tab you'll see your CodeCarbon Footprint visualization in the Comet UI. To render the visualization by default, save your <code>View</code>. And voil√†! Every time you run your experiments, you'll be able to visualize your CodeCarbon emissions data alongside everything else you need to track for your research.</p> <p></p>","path":["Getting Started","Comet Integration"],"tags":[]},{"location":"getting-started/examples/","level":1,"title":"Examples","text":"<p>Following are examples to train a Deep Learning model on MNIST Data to recognize digits in images using TensorFlow.</p>","path":["Getting Started","Examples"],"tags":[]},{"location":"getting-started/examples/#using-the-decorator","level":2,"title":"Using the Decorator","text":"<p>This is the simplest way to use the CodeCarbon tracker with two lines of code. You just need to copy-paste <code>from codecarbon import track_emissions</code> and add the <code>@track_emissions</code> decorator to your training function. The emissions will be tracked automatically and printed at the end of the training.</p> <p>But you can't get them in your code, see the Context Manager section below for that.</p> <pre><code>import tensorflow as tf\nfrom codecarbon import track_emissions\n\n\n@track_emissions(project_name=\"mnist\")\ndef train_model():\n    mnist = tf.keras.datasets.mnist\n    (x_train, y_train), (x_test, y_test) = mnist.load_data()\n    x_train, x_test = x_train / 255.0, x_test / 255.0\n    model = tf.keras.models.Sequential(\n        [\n            tf.keras.layers.Flatten(input_shape=(28, 28)),\n            tf.keras.layers.Dense(128, activation=\"relu\"),\n            tf.keras.layers.Dropout(0.2),\n            tf.keras.layers.Dense(10),\n        ]\n    )\n    loss_fn = tf.keras.losses.SparseCategoricalCrossentropy(from_logits=True)\n\n    model.compile(optimizer=\"adam\", loss=loss_fn, metrics=[\"accuracy\"])\n\n    model.fit(x_train, y_train, epochs=10)\n\n    return model\n\n\nif __name__ == \"__main__\":\n    model = train_model()\n</code></pre>","path":["Getting Started","Examples"],"tags":[]},{"location":"getting-started/examples/#using-the-context-manager","level":2,"title":"Using the Context Manager","text":"<p>We think this is the best way to use CodeCarbon. Still only two lines of code, and you can get the emissions in your code.</p> <pre><code>import tensorflow as tf\n\nfrom codecarbon import EmissionsTracker\n\nmnist = tf.keras.datasets.mnist\n\n(x_train, y_train), (x_test, y_test) = mnist.load_data()\nx_train, x_test = x_train / 255.0, x_test / 255.0\n\n\nmodel = tf.keras.models.Sequential(\n    [\n        tf.keras.layers.Flatten(input_shape=(28, 28)),\n        tf.keras.layers.Dense(128, activation=\"relu\"),\n        tf.keras.layers.Dropout(0.2),\n        tf.keras.layers.Dense(10),\n    ]\n)\n\nloss_fn = tf.keras.losses.SparseCategoricalCrossentropy(from_logits=True)\n\nwith EmissionsTracker() as tracker:\n    model.compile(optimizer=\"adam\", loss=loss_fn, metrics=[\"accuracy\"])\n    model.fit(x_train, y_train, epochs=10)\n\n# Display the emissions data\nprint(f\"\\nCarbon emissions from computation: {tracker.final_emissions * 1000:.4f} g CO2eq\")\nprint(\"\\nDetailed emissions data:\", tracker.final_emissions_data)\n</code></pre>","path":["Getting Started","Examples"],"tags":[]},{"location":"getting-started/examples/#using-the-explicit-object","level":2,"title":"Using the Explicit Object","text":"This is the recommended way to use the CodeCarbon tracker in a Notebook you instantiate the tracker and call the <code>start()</code> method at the beginning of the Notebook. You call the <code>stop()</code> method at the end of the Notebook to stop the tracker and get the emissions. <p>If not in an interactive Notebook, always use a <code>try...finally</code> block to ensure that the tracker is stopped even if an error occurs during training. This is important to ensure the CodeCarbon scheduler is stopped. If you don't use <code>try...finally</code>, the scheduler will continue running in the background after your computation code has crashed, so your program will never finish.</p> <pre><code>import tensorflow as tf\n\nfrom codecarbon import EmissionsTracker\n\nmnist = tf.keras.datasets.mnist\n\n(x_train, y_train), (x_test, y_test) = mnist.load_data()\nx_train, x_test = x_train / 255.0, x_test / 255.0\n\n\nmodel = tf.keras.models.Sequential(\n    [\n        tf.keras.layers.Flatten(input_shape=(28, 28)),\n        tf.keras.layers.Dense(128, activation=\"relu\"),\n        tf.keras.layers.Dropout(0.2),\n        tf.keras.layers.Dense(10),\n    ]\n)\n\nloss_fn = tf.keras.losses.SparseCategoricalCrossentropy(from_logits=True)\n\nmodel.compile(optimizer=\"adam\", loss=loss_fn, metrics=[\"accuracy\"])\n\ntracker = EmissionsTracker()\ntracker.start()\ntry:\n    model.fit(x_train, y_train, epochs=10)\nexcept Exception as e:\n    print(f\"An error occurred: {e}\")\nfinally:\n    emissions: float = tracker.stop()\n    print(emissions)\n</code></pre> <p>Other examples are available in the project GitHub repository.</p>","path":["Getting Started","Examples"],"tags":[]},{"location":"getting-started/installation/","level":1,"title":"Installing CodeCarbon","text":"","path":["Getting Started","Installing CodeCarbon"],"tags":[]},{"location":"getting-started/installation/#from-pypi-repository","level":2,"title":"From PyPi repository","text":"<p>The package is hosted on the pip repository here.</p> <p>To install the package, run the following command in your terminal.</p> <pre><code>pip install codecarbon\n</code></pre>","path":["Getting Started","Installing CodeCarbon"],"tags":[]},{"location":"getting-started/installation/#using-conda-environments","level":2,"title":"Using Conda environments","text":"<p>If you're using Conda for environment management, you can install CodeCarbon with pip in your Conda environment:</p> <pre><code>conda create --name codecarbon\nconda activate codecarbon\npip install codecarbon\n</code></pre> <p>Note</p> <p>While CodeCarbon can be used in Conda environments, we no longer maintain Conda packages. We recommend using <code>pip install codecarbon</code> within your Conda environment, which works seamlessly with Conda.</p> <p>Note</p> <p>We recommend using Python 3.8 or above.</p>","path":["Getting Started","Installing CodeCarbon"],"tags":[]},{"location":"getting-started/installation/#dependencies","level":2,"title":"Dependencies","text":"<p>The following packages are used by the CodeCarbon package, and will be installed along with the package itself:</p> <pre><code>arrow\nclick\nfief-client[cli]\npandas\nprometheus_client\npsutil\npy-cpuinfo\nnvidia-ml-py\nrapidfuzz\nrequests\nquestionary\nrich\ntyper\n</code></pre> <p>Please refer to pyproject.toml for the latest list of the packages used.</p>","path":["Getting Started","Installing CodeCarbon"],"tags":[]},{"location":"getting-started/installation/#non-python-users-standalone-installer","level":2,"title":"(Non-Python users) Standalone installer","text":"<p>If you are not using Python but would like to run CodeCarbon (for instance to use the CodeCarbon Command line), we provide a standalone installer.</p> <p>Use curl to download and run the script:</p> <pre><code>curl -LsSf https://codecarbon.io/scripts/install.sh | sh\n</code></pre> <p>For Windows (PowerShell):</p> <pre><code>powershell -ExecutionPolicy ByPass -c \"irm https://codecarbon.io/scripts/install.ps1 | iex\"\n</code></pre>","path":["Getting Started","Installing CodeCarbon"],"tags":[]},{"location":"getting-started/parameters/","level":1,"title":"Parameters","text":"<p>Parameters can be set via <code>EmissionsTracker()</code>, <code>OfflineEmissionsTracker()</code>, the <code>@track_emissions</code> decorator, config files, or environment variables. See Configuration for priority order.</p> <p>PUE</p> <p>PUE is a multiplication factor provided by the user. Old datacenters have PUE up to 2.2, new greener ones as low as 1.1.</p> <p>GPU selection</p> <p>If you use <code>CUDA_VISIBLE_DEVICES</code> to set GPUs, CodeCarbon will automatically populate <code>gpu_ids</code>. Manual <code>gpu_ids</code> overrides this.</p>","path":["Getting Started","Parameters"],"tags":[]},{"location":"getting-started/parameters/#emissionstracker-baseemissionstracker","level":2,"title":"EmissionsTracker / BaseEmissionsTracker","text":"<p><code>EmissionsTracker</code> and <code>OfflineEmissionsTracker</code> inherit from <code>BaseEmissionsTracker</code>. All parameters are documented below:</p>","path":["Getting Started","Parameters"],"tags":[]},{"location":"getting-started/parameters/#codecarbon.emissions_tracker.BaseEmissionsTracker","level":2,"title":"<code>codecarbon.emissions_tracker.BaseEmissionsTracker</code>","text":"<p>               Bases: <code>ABC</code></p> <p>Primary abstraction with Emissions Tracking functionality. Has two abstract methods, <code>_get_geo_metadata</code> and <code>_get_cloud_metadata</code> that are implemented by two concrete classes: <code>OfflineCarbonTracker</code> and <code>CarbonTracker.</code></p> <p>Parameters:</p> Name Type Description Default <code>project_name</code> <code>Optional[str]</code> <p>Project name for current experiment run, default name is \"codecarbon\".</p> <code>_sentinel</code> <code>measure_power_secs</code> <code>Optional[float]</code> <p>Interval (in seconds) to measure hardware power usage, defaults to 15.</p> <code>_sentinel</code> <code>api_call_interval</code> <code>Optional[int]</code> <p>Number of measurements between API calls (default: 8). -1: call API only on flush() and at the end. 1: at every measure. 2: every 2 measures, and so on.</p> <code>_sentinel</code> <code>api_endpoint</code> <code>Optional[str]</code> <p>Optional URL of Code Carbon API endpoint for sending emissions data.</p> <code>_sentinel</code> <code>api_key</code> <code>Optional[str]</code> <p>API key for Code Carbon API (mandatory!).</p> <code>_sentinel</code> <code>output_dir</code> <code>Optional[str]</code> <p>Directory path to which the experiment details are logged, defaults to current directory.</p> <code>_sentinel</code> <code>output_file</code> <code>Optional[str]</code> <p>Name of the output CSV file, defaults to <code>emissions.csv</code>.</p> <code>_sentinel</code> <code>save_to_file</code> <code>Optional[bool]</code> <p>Indicates if the emission artifacts should be logged to a file, defaults to True.</p> <code>_sentinel</code> <code>save_to_api</code> <code>Optional[bool]</code> <p>Indicates if the emission artifacts should be sent to the CodeCarbon API, defaults to False.</p> <code>_sentinel</code> <code>save_to_logger</code> <code>Optional[bool]</code> <p>Indicates if the emission artifacts should be written to a dedicated logger, defaults to False.</p> <code>_sentinel</code> <code>logging_logger</code> <code>Optional[LoggerOutput]</code> <p>LoggerOutput object encapsulating a logging.logger or a Google Cloud logger.</p> <code>_sentinel</code> <code>save_to_prometheus</code> <code>Optional[bool]</code> <p>Indicates if the emission artifacts should be pushed to prometheus, defaults to False.</p> <code>_sentinel</code> <code>save_to_logfire</code> <code>Optional[bool]</code> <p>Indicates if the emission artifacts should be written to a logfire observability platform, defaults to False.</p> <code>_sentinel</code> <code>prometheus_url</code> <code>Optional[str]</code> <p>url of the prometheus server, defaults to <code>localhost:9091</code>.</p> <code>_sentinel</code> <code>output_handlers</code> <code>Optional[List[BaseOutput]]</code> <p>List of custom output handlers to use. Defaults to [].</p> <code>_sentinel</code> <code>gpu_ids</code> <code>Optional[List]</code> <p>Comma-separated list of GPU ids to track, defaults to None. Can be integer indexes of GPUs on the system, or prefixes to match against GPU identifiers. See NVIDIA docs on CUDA environment variables.</p> <code>_sentinel</code> <code>emissions_endpoint</code> <code>Optional[str]</code> <p>Optional URL of http endpoint for sending emissions data.</p> <code>_sentinel</code> <code>experiment_id</code> <code>Optional[str]</code> <p>Id of the experiment.</p> <code>_sentinel</code> <code>experiment_name</code> <code>Optional[str]</code> <p>Label of the experiment</p> <code>_sentinel</code> <code>electricitymaps_api_token</code> <code>Optional[str]</code> <p>API token for electricitymaps.com (formerly co2signal.com)</p> <code>_sentinel</code> <code>co2_signal_api_token</code> <code>Optional[str]</code> <p>[DEPRECATED] Use electricitymaps_api_token instead. Old parameter name for backward compatibility.</p> <code>_sentinel</code> <code>tracking_mode</code> <code>Optional[str]</code> <p>One of \"process\" or \"machine\" in order to measure the power consumption due to the entire machine or to try and isolate the tracked processe's in isolation. Defaults to \"machine\".</p> <code>_sentinel</code> <code>log_level</code> <code>Optional[Union[int, str]]</code> <p>Global codecarbon log level. Accepts one of:   {\"debug\", \"info\", \"warning\", \"error\", \"critical\"}. Defaults to \"info\".</p> <code>_sentinel</code> <code>on_csv_write</code> <code>Optional[str]</code> <p>When calling tracker.flush() manually: \"update\" to overwrite the existing run_id row, or \"append\" to add a new row to the CSV file. Defaults to \"append\".</p> <code>_sentinel</code> <code>logger_preamble</code> <code>Optional[str]</code> <p>String to systematically include in the logger. messages. Defaults to \"\".</p> <code>_sentinel</code> <code>force_cpu_power</code> <code>Optional[int]</code> <p>Force the CPU max power consumption in watts. Use this if you know the TDP of your machine.</p> <code>_sentinel</code> <code>force_ram_power</code> <code>Optional[int]</code> <p>Force the RAM power consumption in watts. Use this if you know the power consumption of your RAM. Estimate with <code>sudo lshw -C memory -short | grep DIMM</code> to get RAM slots, then RAM power (W) = Number of RAM Slots √ó 5 Watts.</p> <code>_sentinel</code> <code>pue</code> <code>Optional[float]</code> <p>PUE (Power Usage Effectiveness) of the data center where the experiment is being run.</p> <code>_sentinel</code> <code>force_mode_cpu_load</code> <code>Optional[bool]</code> <p>Force the addition of a CPU in MODE_CPU_LOAD</p> <code>_sentinel</code> <code>allow_multiple_runs</code> <code>Optional[bool]</code> <p>Allow multiple CodeCarbon instances on the same machine. Defaults to True since v3 (was False in v2).</p> <code>_sentinel</code> <code>wue</code> <code>Optional[float]</code> <p>WUE (Water Usage Effectiveness) of the data center. Units of L/kWh: litres of water consumed per kilowatt-hour of electricity consumed.</p> <code>_sentinel</code> <code>rapl_include_dram</code> <code>Optional[bool]</code> <p>Include DRAM (memory) power in RAPL measurements on Linux, defaults to False. When True, measures CPU package + DRAM. Only affects systems where RAPL exposes separate DRAM domains.</p> <code>_sentinel</code> <code>rapl_prefer_psys</code> <code>Optional[bool]</code> <p>Prefer psys (platform) RAPL domain over package domains on Linux, defaults to False. When True, uses total platform power (CPU + chipset + PCIe). When False, uses package domains which are more reliable. Note: psys can report higher values than CPU TDP and may be unreliable on older systems.</p> <code>_sentinel</code>","path":["Getting Started","Parameters"],"tags":[]},{"location":"getting-started/parameters/#offlineemissionstracker-additional-parameters","level":2,"title":"OfflineEmissionsTracker (additional parameters)","text":"<p><code>OfflineEmissionsTracker</code> adds these parameters for offline mode:</p>","path":["Getting Started","Parameters"],"tags":[]},{"location":"getting-started/parameters/#codecarbon.emissions_tracker.OfflineEmissionsTracker","level":2,"title":"<code>codecarbon.emissions_tracker.OfflineEmissionsTracker</code>","text":"<p>               Bases: <code>BaseEmissionsTracker</code></p> <p>Offline implementation of the <code>EmissionsTracker</code> In addition to the standard arguments, the following are required.</p> <p>Parameters:</p> Name Type Description Default <code>country_iso_code</code> <code>Optional[str]</code> <p>3-letter ISO code of the country where the experiment is being run. See global_energy_mix.json for available countries.</p> <code>_sentinel</code> <code>region</code> <code>Optional[str]</code> <p>Optional Province/State/City where the infrastructure is hosted. Supported for US States and Canada (e.g. California, New York).</p> <code>_sentinel</code> <code>cloud_provider</code> <code>Optional[str]</code> <p>The cloud provider specified for estimating emissions intensity, defaults to None. See https://github.com/mlco2/codecarbon/          blob/master/codecarbon/data/cloud/impact.csv for a list of cloud providers</p> <code>_sentinel</code> <code>cloud_region</code> <code>Optional[str]</code> <p>The region of the cloud data center, defaults to None. See https://github.com/mlco2/codecarbon/            blob/master/codecarbon/data/cloud/impact.csv for a list of cloud regions.</p> <code>_sentinel</code> <code>country_2letter_iso_code</code> <code>Optional[str]</code> <p>For use with the Electricity Maps emissions API. See http://api.electricitymap.org/v3/zones for a list of codes and their corresponding locations.</p> <code>_sentinel</code>","path":["Getting Started","Parameters"],"tags":[]},{"location":"getting-started/parameters/#track_emissions-decorator","level":2,"title":"@track_emissions Decorator","text":"<p>The decorator accepts the same parameters as <code>EmissionsTracker</code>, plus <code>offline</code> and <code>country_iso_code</code> for offline mode:</p>","path":["Getting Started","Parameters"],"tags":[]},{"location":"getting-started/parameters/#codecarbon.emissions_tracker.track_emissions","level":2,"title":"<code>codecarbon.emissions_tracker.track_emissions</code>","text":"<p>Decorator that supports both <code>EmissionsTracker</code> and <code>OfflineEmissionsTracker</code></p> <p>Parameters:</p> Name Type Description Default <code>fn</code> <code>Callable</code> <p>Function to be decorated</p> <code>None</code> <code>project_name</code> <code>Optional[str]</code> <p>Project name for current experiment run, default name is \"codecarbon\".</p> <code>_sentinel</code> <code>measure_power_secs</code> <code>Optional[int]</code> <p>Interval (in seconds) to measure hardware power usage, defaults to 15.</p> <code>_sentinel</code> <code>api_call_interval</code> <code>int</code> <p>Number of measure to make before calling the Code Carbon API.</p> <code>_sentinel</code> <code>api_endpoint</code> <code>Optional[str]</code> <p>Optional URL of Code Carbon API endpoint for sending emissions data.</p> <code>_sentinel</code> <code>api_key</code> <code>Optional[str]</code> <p>API key for Code Carbon API (mandatory!).</p> <code>_sentinel</code> <code>output_dir</code> <code>Optional[str]</code> <p>Directory path to which the experiment details are logged, defaults to current directory.</p> <code>_sentinel</code> <code>output_file</code> <code>Optional[str]</code> <p>Name of output CSV file, defaults to <code>emissions.csv</code></p> <code>_sentinel</code> <code>save_to_file</code> <code>Optional[bool]</code> <p>Indicates if the emission artifacts should be logged to a file, defaults to True.</p> <code>_sentinel</code> <code>save_to_api</code> <code>Optional[bool]</code> <p>Indicates if the emission artifacts should be send to the CodeCarbon API, defaults to False.</p> <code>_sentinel</code> <code>save_to_logger</code> <code>Optional[bool]</code> <p>Indicates if the emission artifacts should be written to a dedicated logger, defaults to False.</p> <code>_sentinel</code> <code>logging_logger</code> <code>Optional[LoggerOutput]</code> <p>LoggerOutput object encapsulating a logging.logger or a Google Cloud logger.</p> <code>_sentinel</code> <code>save_to_prometheus</code> <code>Optional[bool]</code> <p>Indicates if the emission artifacts should be pushed to prometheus, defaults to False.</p> <code>_sentinel</code> <code>save_to_logfire</code> <code>Optional[bool]</code> <p>Indicates if the emission artifacts should be pushed to logfire, defaults to False.</p> <code>_sentinel</code> <code>prometheus_url</code> <code>Optional[str]</code> <p>url of the prometheus server, defaults to <code>localhost:9091</code>.</p> <code>_sentinel</code> <code>output_handlers</code> <code>Optional[List[BaseOutput]]</code> <p>List of output handlers to use.</p> <code>_sentinel</code> <code>gpu_ids</code> <code>Optional[List]</code> <p>User-specified known gpu ids to track. Defaults to None, which means that all available gpus will be tracked. It needs to be a list of integers or a comma-separated string. Valid examples: [1, 3, 4] or \"1,2\".</p> <code>_sentinel</code> <code>emissions_endpoint</code> <code>Optional[str]</code> <p>Optional URL of http endpoint for sending emissions data.</p> <code>_sentinel</code> <code>experiment_id</code> <code>Optional[str]</code> <p>Id of the experiment.</p> <code>_sentinel</code> <code>experiment_name</code> <code>Optional[str]</code> <p>Label of the experiment</p> <code>_sentinel</code> <code>electricitymaps_api_token</code> <code>Optional[str]</code> <p>API token for electricitymaps.com (formerly co2signal.com)</p> <code>_sentinel</code> <code>co2_signal_api_token</code> <code>Optional[str]</code> <p>[DEPRECATED] Use electricitymaps_api_token instead. Old parameter name for backward compatibility.</p> <code>_sentinel</code> <code>tracking_mode</code> <code>Optional[str]</code> <p>One of \"process\" or \"machine\" in order to measure the power consumption due to the entire machine or to try and isolate the tracked processe's in isolation. Defaults to \"machine\".</p> <code>_sentinel</code> <code>log_level</code> <code>Optional[Union[int, str]]</code> <p>Global codecarbon log level. Accepts one of: {\"debug\", \"info\", \"warning\", \"error\", \"critical\"}. Defaults to \"info\".</p> <code>_sentinel</code> <code>on_csv_write</code> <code>Optional[str]</code> <p>When calling tracker.flush() manually: \"update\" to overwrite the existing run_id row, or \"append\" to add a new row. Defaults to \"append\".</p> <code>_sentinel</code> <code>logger_preamble</code> <code>Optional[str]</code> <p>String to systematically include in the logger. messages. Defaults to \"\".</p> <code>_sentinel</code> <code>allow_multiple_runs</code> <code>Optional[bool]</code> <p>Allow multiple CodeCarbon instances on the same machine. Defaults to True since v3 (was False in v2).</p> <code>_sentinel</code> <code>offline</code> <code>Optional[bool]</code> <p>Run the tracker in offline mode, defaults to False.</p> <code>_sentinel</code> <code>country_iso_code</code> <code>Optional[str]</code> <p>3-letter ISO code of the country where the experiment is being run. Required if offline=True. See global_energy_mix.json.</p> <code>_sentinel</code> <code>region</code> <code>Optional[str]</code> <p>Optional Province/State/City where the infrastructure is hosted. Supported for US States (e.g. California, New York).</p> <code>_sentinel</code> <code>cloud_provider</code> <code>Optional[str]</code> <p>The cloud provider specified for estimating emissions intensity, defaults to None. See https://github.com/mlco2/codecarbon/                  blob/master/codecarbon/data/cloud/impact.csv for a list of cloud providers.</p> <code>_sentinel</code> <code>cloud_region</code> <code>Optional[str]</code> <p>The region of the cloud data center, defaults to None. See https://github.com/mlco2/codecarbon/                    blob/master/codecarbon/data/cloud/impact.csv for a list of cloud regions.</p> <code>_sentinel</code> <code>country_2letter_iso_code</code> <code>Optional[str]</code> <p>For use with the Electricity Maps emissions API. See http://api.electricitymap.org/v3/zones for a list of codes and their corresponding locations.</p> <code>_sentinel</code> <code>force_cpu_power</code> <code>Optional[int]</code> <p>Force the CPU max power consumption in watts. Use if you know the TDP of your machine.</p> <code>_sentinel</code> <code>force_ram_power</code> <code>Optional[int]</code> <p>Force the RAM power consumption in watts. Estimate with <code>sudo lshw -C memory -short | grep DIMM</code> for RAM slots, then RAM power (W) = Number of RAM Slots √ó 5 Watts.</p> <code>_sentinel</code> <code>pue</code> <code>Optional[float]</code> <p>PUE (Power Usage Effectiveness) of the data center.</p> <code>_sentinel</code> <code>wue</code> <code>Optional[float]</code> <p>WUE (Water Usage Effectiveness) of the data center. Units of L/kWh: litres of water consumed per kilowatt-hour of electricity consumed.</p> <code>_sentinel</code> <code>rapl_include_dram</code> <code>Optional[bool]</code> <p>Include DRAM in RAPL measurements on Linux (default: False). When True, measures CPU package + DRAM.</p> <code>_sentinel</code> <code>rapl_prefer_psys</code> <code>Optional[bool]</code> <p>Prefer psys over package domains for RAPL on Linux (default: False). When True, uses total platform power.</p> <code>_sentinel</code> <p>Returns:</p> Type Description <p>The decorated function</p>","path":["Getting Started","Parameters"],"tags":[]},{"location":"getting-started/test_on_scaleway/","level":1,"title":"Test of CodeCarbon on Scaleway hardware","text":"<p>We use Scaleway hardware to test CodeCarbon on a real-world scenario. We use the following hardware:</p> <ul> <li>EM-I120E-NVME: AMD EPYC 8024P, 64 GB, 2√ó960 GB NVMe</li> <li>EM-B112X-SSD: 2√ó Intel Xeon E5-2620 v3 @ 2.40GHz</li> </ul> <p>85 W TDP for the Intel(R) Xeon(R) CPU E5-2620 v3 @ 2.40GHz</p> <p>Choose Ubuntu as OS because new version of stress-ng is not available on Debian 12 (Bookworm).</p> <p>Connect to the server:</p> <pre><code>ssh ubuntu@51.159.214.207\n</code></pre> <p>Install and run the test:</p> <pre><code>sudo chmod a+r -R /sys/class/powercap/intel-rapl/subsystem/*\nsudo apt update &amp;&amp; sudo apt install -y git pipx python3-launchpadlib htop\npipx ensurepath\nsudo add-apt-repository -y ppa:colin-king/stress-ng\nsudo apt update &amp;&amp; sudo apt install -y stress-ng\nexport PATH=$PATH:/home/ubuntu/.local/bin\ngit clone https://github.com/mlco2/codecarbon.git\ncd codecarbon\ngit checkout use-cpu-load\ncurl -LsSf https://astral.sh/uv/install.sh | sh\nuv run python examples/compare_cpu_load_and_RAPL.py\n</code></pre> <p>To do a full code CPU load, we run the following command:</p> <pre><code>stress-ng --cpu 0 --cpu-method matrixprod --metrics-brief --rapl --perf -t 60s\n</code></pre> <p>Get back the data from the server:</p> <pre><code>mkdir -p codecarbon/data/hardware/cpu_load_profiling/E3-1240/\nscp ubuntu@51.159.214.207:/home/ubuntu/codecarbon/*.csv codecarbon/data/hardware/cpu_load_profiling/E5-1240/\n</code></pre> <p>You can now delete the server in the Scaleway console.</p> <p>For the results, see the notebook XXX.</p>","path":["Getting Started","Test of CodeCarbon on Scaleway hardware"],"tags":[]},{"location":"getting-started/usage/","level":1,"title":"Quickstart","text":"<p>The CO2 tracking tool can be used along with any computing framework. It supports both <code>online</code> (with internet access) and <code>offline</code> (without internet access) modes. The tracker can be used in the following ways:</p>","path":["Getting Started","Quickstart"],"tags":[]},{"location":"getting-started/usage/#online-mode","level":2,"title":"Online Mode","text":"<p>When the environment has internet access, the <code>EmissionsTracker</code> object or the <code>track_emissions</code> decorator can be used, which has the <code>offline</code> parameter set to <code>False</code> by default.</p>","path":["Getting Started","Quickstart"],"tags":[]},{"location":"getting-started/usage/#usage-command-line","level":3,"title":"Command line","text":"<p>Create a minimal configuration file (just follow the prompts) :</p> <pre><code>codecarbon config\n</code></pre> <p></p> <p>Then login from your terminal to authenticate CLI/API usage:</p> <pre><code>codecarbon login\n</code></pre> <p>You can use the same command to modify an existing config :</p> <p></p> <p>If you want to track the emissions of a computer without having to modify your code, you can use :</p> <pre><code>codecarbon monitor\n</code></pre> <p>You have to stop the monitoring manually with <code>Ctrl+C</code>.</p> <p>If you only need local measurement and do not want to send data to the API, use:</p> <pre><code>codecarbon monitor --no-api\n</code></pre> <p>If you want to detect the hardware of your computer without starting any measurement, you can use:</p> <pre><code>codecarbon detect\n</code></pre> <p>It will print the detected RAM, CPU and GPU information.</p> <p>In the following example you will see how to use the CLI to monitor all the emissions of you computer and sending everything to an API running on \"localhost:8008\" (Or you can start a private local API with \"docker-compose up\"). Using the public API with this is not supported yet (coming soon!)</p> <p></p> <p>The command line could also works without internet by providing the country code like this:</p> <pre><code>codecarbon monitor --offline --country-iso-code FRA\n</code></pre>","path":["Getting Started","Quickstart"],"tags":[]},{"location":"getting-started/usage/#running-any-command-with-codecarbon","level":3,"title":"Running Any Command with CodeCarbon","text":"<p>If you want to track emissions while running any command or program (not just Python scripts), you can use the <code>codecarbon monitor --</code> command. This allows non-Python users to measure machine emissions during the execution of any command:</p> <pre><code>codecarbon monitor -- &lt;your_command&gt;\n</code></pre> <p>Do not surround <code>&lt;your_command&gt;</code> with quotes. The double hyphen <code>--</code> indicates the end of CodeCarbon options and the beginning of the command to run.</p> <p>Examples:</p> <pre><code># Run a shell script\ncodecarbon monitor -- ./benchmark.sh\n\n# Run a command with arguments (use quotes for special characters)\ncodecarbon monitor -- bash -c 'echo \"Processing...\"; sleep 30; echo \"Done!\"'\n\n# Run Python scripts\ncodecarbon monitor -- python train_model.py\n\n# Run Node.js applications\ncodecarbon monitor -- node app.js\n\n# Run tests with output redirection\ncodecarbon monitor -- npm run test &gt; output.txt\n\n# Display the CodeCarbon detailed logs\ncodecarbon monitor --log-level debug -- python --version\n</code></pre> <p>Output:</p> <p>When the command completes, CodeCarbon displays a summary report and saves the emissions data to a CSV file:</p> <pre><code>üå± CodeCarbon: Starting emissions tracking...\n   Command: bash -c echo \"Processing...\"; sleep 30; echo \"Done!\"\n\nProcessing...\nDone!\n\n============================================================\nüå± CodeCarbon Emissions Report\n============================================================\n   Command: bash -c echo \"Processing...\"; sleep 30; echo \"Done!\"\n   Emissions: 0.0317 g CO2eq\n   Saved to: /home/user/emissions.csv\n   ‚ö†Ô∏è  Note: Measured entire machine (includes all system processes)\n============================================================\n</code></pre> <p>Note</p> <p>The <code>codecarbon monitor --</code> command tracks process-level emissions (only the specific command), not the entire machine. For machine-level tracking, use the <code>codecarbon monitor</code> command.</p> <p>For more fine-grained tracking, implementing CodeCarbon in your code allows you to track the emissions of a specific block of code.</p>","path":["Getting Started","Quickstart"],"tags":[]},{"location":"getting-started/usage/#explicit-object","level":3,"title":"Explicit Object","text":"<p>In the case of absence of a single entry and stop point for the training code base, users can instantiate a <code>EmissionsTracker</code> object and pass it as a parameter to function calls to start and stop the emissions tracking of the compute section.</p> <pre><code>from codecarbon import EmissionsTracker\ntracker = EmissionsTracker()\ntracker.start()\ntry:\n     # Compute intensive code goes here\n     _ = 1 + 1\nfinally:\n     tracker.stop()\n</code></pre> <p>This mode is recommended when using a Jupyter Notebook. You call <code>tracker.start()</code> at the beginning of the Notebook, and call <code>tracker.stop()</code> in the last cell.</p> <p>This mode also allows you to record the monitoring with <code>tracker.flush()</code> that writes the emissions to disk or call the API depending on the configuration, but keep running the experiment.</p> <p>If you want to monitor small piece of code, like a model inference, you could use the task manager:</p> <pre><code>try:\n    tracker = EmissionsTracker(project_name=\"bert_inference\", measure_power_secs=10)\n    tracker.start_task(\"load dataset\")\n    dataset = load_dataset(\"imdb\", split=\"test\")\n    imdb_emissions = tracker.stop_task()\n    tracker.start_task(\"build model\")\n    model = build_model()\n    model_emissions = tracker.stop_task()\nfinally:\n    _ = tracker.stop()\n</code></pre> <p>This way CodeCarbon will track the emissions of each task . The task will not be written to disk to prevent overhead, you have to get the results from the return of <code>stop_task()</code>. If no name is provided, CodeCarbon will generate a uuid.</p> <p>Please note that you can't use task mode and normal mode at the same time. Because <code>start_task</code> will stop the scheduler as we do not want it to interfere with the task measurement.</p>","path":["Getting Started","Quickstart"],"tags":[]},{"location":"getting-started/usage/#context-manager","level":3,"title":"Context manager","text":"<p>The <code>Emissions tracker</code> also works as a context manager.</p> <pre><code>from codecarbon import EmissionsTracker\n\nwith EmissionsTracker() as tracker:\n    # Compute intensive training code goes here\n</code></pre> <p>This mode is recommended when you want to monitor a specific block of code.</p>","path":["Getting Started","Quickstart"],"tags":[]},{"location":"getting-started/usage/#decorator","level":3,"title":"Decorator","text":"<p>In case the training code base is wrapped in a function, users can use the decorator <code>@track_emissions</code> within the function to enable tracking emissions of the training code.</p> <pre><code>from codecarbon import track_emissions\n\n@track_emissions\ndef training_loop():\n    # Compute intensive training code goes here\n</code></pre> <p>This mode is recommended if you have a training function.</p> <p>Note</p> <p>This will write a csv file named emissions.csv in the current directory.</p>","path":["Getting Started","Quickstart"],"tags":[]},{"location":"getting-started/usage/#offline-mode","level":2,"title":"Offline Mode","text":"<p>An offline version is available to support restricted environments without internet access. The internal computations remain unchanged; however, a <code>country_iso_code</code> parameter, which corresponds to the 3-letter alphabet ISO Code of the country where the compute infrastructure is hosted, is required to fetch Carbon Intensity details of the regional electricity used. A complete list of country ISO codes can be found on Wikipedia.</p>","path":["Getting Started","Quickstart"],"tags":[]},{"location":"getting-started/usage/#explicit-object_1","level":3,"title":"Explicit Object","text":"<p>Developers can use the <code>OfflineEmissionsTracker</code> object to track emissions as follows:</p> <pre><code>from codecarbon import OfflineEmissionsTracker\ntracker = OfflineEmissionsTracker(country_iso_code=\"CAN\")\ntracker.start()\n# GPU intensive training code\ntracker.stop()\n</code></pre>","path":["Getting Started","Quickstart"],"tags":[]},{"location":"getting-started/usage/#context-manager_1","level":3,"title":"Context manager","text":"<p>The <code>OfflineEmissionsTracker</code> also works as a context manager</p> <pre><code>from codecarbon import OfflineEmissionsTracker\n\nwith OfflineEmissionsTracker() as tracker:\n# GPU intensive training code  goes here\n</code></pre>","path":["Getting Started","Quickstart"],"tags":[]},{"location":"getting-started/usage/#decorator_1","level":3,"title":"Decorator","text":"<p>The <code>track_emissions</code> decorator in offline mode requires following two parameters:</p> <ul> <li><code>offline</code> needs to be set to <code>True</code>, which defaults to <code>False</code> for     online mode.</li> <li><code>country_iso_code</code> the 3-letter alphabet ISO Code of the country     where the compute infrastructure is hosted</li> </ul> <pre><code>from codecarbon import track_emissions\n@track_emissions(offline=True, country_iso_code=\"CAN\")\ndef training_loop():\n    # training code goes here\n    pass\n</code></pre> <p>The Carbon emissions will be saved to a <code>emissions.csv</code> file in the same directory. Please refer to the complete API for additional parameters and configuration options.</p>","path":["Getting Started","Quickstart"],"tags":[]},{"location":"getting-started/usage/#configuration","level":1,"title":"Configuration","text":"","path":["Getting Started","Quickstart"],"tags":[]},{"location":"getting-started/usage/#configuration-priority","level":2,"title":"Configuration priority","text":"<p>CodeCarbon is structured so that you can configure it in a hierarchical manner:</p> <ul> <li>global parameters in your home folder <code>~/.codecarbon.config</code></li> <li>local parameters (with respect to the current working     directory) in <code>./.codecarbon.config</code></li> <li>environment variables parameters starting with <code>CODECARBON_</code></li> <li>script parameters in the tracker's initialization as     <code>EmissionsTracker(param=value)</code></li> </ul> <p>Configuration files</p> <p>Configuration files must be named <code>.codecarbon.config</code> and start with a section header <code>[codecarbon]</code> as the first line in the file.</p> <p>For instance:</p> <ul> <li> <p><code>~/.codecarbon.config</code></p> <pre><code>[codecarbon]\nmeasure_power_secs=10\nsave_to_file=local-overwrite\nemissions_endpoint=localhost:7777\n</code></pre> </li> <li> <p><code>./.codecarbon.config</code> will override <code>~/.codecarbon.config</code> if the     same parameter is set in both files:</p> <pre><code>[codecarbon]\nsave_to_file = true\noutput_dir = /Users/victor/emissions\nelectricitymaps_api_token=script-overwrite\nexperiment_id = 235b1da5-aaaa-aaaa-aaaa-893681599d2c\nlog_level = DEBUG\ntracking_mode = process\n</code></pre> </li> <li> <p>environment variables will override <code>./.codecarbon.config</code> if the     same parameter is set in both files:</p> <pre><code>export CODECARBON_GPU_IDS=\"0, 1\"\nexport CODECARBON_LOG_LEVEL=\"WARNING\"\n</code></pre> </li> <li> <p>script parameters will override environment variables if the same     parameter is set in both:</p> <pre><code>EmissionsTracker(\n   api_call_interval=4,\n   save_to_api=True,\n   electricitymaps_api_token=\"some-token\")\n</code></pre> </li> </ul> <p>Yields attributes:</p> <pre><code>{\n    \"measure_power_secs\": 10,  # from ~/.codecarbon.config\n    \"save_to_file\": True,   # from ./.codecarbon.config (override ~/.codecarbon.config)\n    \"api_call_interval\": 4, # from script\n    \"save_to_api\": True,   # from script\n    \"experiment_id\": \"235b1da5-aaaa-aaaa-aaaa-893681599d2c\", # from ./.codecarbon.config\n    \"log_level\": \"WARNING\", # from environment variable (override ./.codecarbon.config)\n    \"tracking_mode\": \"process\", # from ./.codecarbon.config\n    \"emissions_endpoint\": \"localhost:7777\", # from ~/.codecarbon.config\n    \"output_dir\": \"/Users/victor/emissions\", # from ./.codecarbon.config\n    \"electricitymaps_api_token\": \"some-token\", # from script (override ./.codecarbon.config)\n    \"gpu_ids\": [0, 1], # from environment variable\n}\n</code></pre> <p>Note</p> <p>If you're wondering about the configuration files' syntax, be aware that under the hood <code>codecarbon</code> uses <code>ConfigParser</code> which relies on the INI syntax.</p>","path":["Getting Started","Quickstart"],"tags":[]},{"location":"getting-started/usage/#access-internet-through-proxy-server","level":2,"title":"Access internet through proxy server","text":"<p>If you need a proxy to access internet, which is needed to call a Web API, like Codecarbon API, you have to set environment variable <code>HTTPS_PROXY</code>, or HTTP_PROXY if calling an <code>http://</code> endpoint.</p> <p>You could do it in your shell:</p> <pre><code>export HTTPS_PROXY=\"http://0.0.0.0:0000\"\n</code></pre> <p>Or in your Python code:</p> <pre><code>import os\n\nos.environ[\"HTTPS_PROXY\"] = \"http://0.0.0.0:0000\"\n</code></pre> <p>For more information, please read the requests library proxy documentation</p>","path":["Getting Started","Quickstart"],"tags":[]},{"location":"introduction/faq/","level":1,"title":"Frequently Asked Questions","text":"","path":["Introduction","Frequently Asked Questions"],"tags":[]},{"location":"introduction/faq/#when-should-i-use-codecarbon-vs-ecologits","level":2,"title":"When should I use CodeCarbon vs EcoLogits?","text":"<p>Use CodeCarbon when you run code on hardware you control‚Äîtraining models, local inference, or any code on your machine, server, or cloud VM. Use EcoLogits when you call GenAI APIs (OpenAI, Anthropic, Mistral, etc.) and want to estimate the environmental impact of those requests. Both are complementary: CodeCarbon for local computing, EcoLogits for remote API inference.</p>","path":["Introduction","Frequently Asked Questions"],"tags":[]},{"location":"introduction/faq/#how-accurate-are-your-estimations","level":2,"title":"How accurate are your estimations?","text":"<p>It is hard to quantify the entirety of computing emissions, because there are many factors in play, notably the life-cycle emissions of computing infrastructure. We therefore only focus on the direct emissions produced by running the actual code, but recognize that there is much work to be done to improve this estimation.</p>","path":["Introduction","Frequently Asked Questions"],"tags":[]},{"location":"introduction/faq/#what-are-the-sources-of-your-energy-carbon-intensity-data","level":2,"title":"What are the sources of your energy carbon intensity data?","text":"","path":["Introduction","Frequently Asked Questions"],"tags":[]},{"location":"introduction/faq/#for-cloud-computing","level":3,"title":"For cloud computing:","text":"<ul> <li>Google Cloud: Google publishes carbon intensity of electricity for Google Cloud.</li> <li>AWS: Amazon has not made datacenter carbon footprints publicly available.</li> <li>Azure: Microsoft has a Sustainability Calculator but does not publish datacenter carbon intensity.</li> </ul>","path":["Introduction","Frequently Asked Questions"],"tags":[]},{"location":"introduction/faq/#for-private-infrastructure","level":3,"title":"For private infrastructure:","text":"<ul> <li>Our World in Data: When available, we use data from ourworldindata.org</li> <li>Global Petrol Prices: We use the electricity mix from globalpetrolprices.com multiplied by the carbon intensity of the source of electricity</li> <li>Default: When no data is available, we default to 475 gCO2.eq/kWh from IEA</li> </ul>","path":["Introduction","Frequently Asked Questions"],"tags":[]},{"location":"introduction/faq/#how-do-i-offset-my-emissions","level":2,"title":"How do I offset my emissions?","text":"<p>There are many offsetting schemes, and it is hard to recommend any single one. For one-shot offsetting, the Gold Standard is often used, and has many offsetting projects to choose from at different prices. There are often local initiatives as well, so try researching what exists in your region/country. For a recurring offset, Project Wren lets you estimate your monthly carbon emissions and offset them via a monthly subscription. Keep in mind that offsetting is a good choice, but reducing your emissions should be the priority.</p>","path":["Introduction","Frequently Asked Questions"],"tags":[]},{"location":"introduction/faq/#does-codecarbon-work-on-windowsmaclinux","level":2,"title":"Does CodeCarbon work on Windows/Mac/Linux?","text":"<p>Yes! CodeCarbon supports: - Linux (primary) - macOS (Intel and Apple Silicon) - Windows (experimental)</p>","path":["Introduction","Frequently Asked Questions"],"tags":[]},{"location":"introduction/faq/#can-i-use-codecarbon-in-a-docker-container","level":2,"title":"Can I use CodeCarbon in a Docker container?","text":"<p>Yes. See our Advanced Installation guide for Docker setup.</p>","path":["Introduction","Frequently Asked Questions"],"tags":[]},{"location":"introduction/faq/#how-can-i-help","level":2,"title":"How can I help?","text":"<p>If you find any functionality missing in the CodeCarbon repo, please open an issue so that you (and others!) can help add it. We did our best to cover all use cases and options, but we count on the open source community to help make the package an even greater success.</p>","path":["Introduction","Frequently Asked Questions"],"tags":[]},{"location":"introduction/faq/#is-my-data-sent-anywhere","level":2,"title":"Is my data sent anywhere?","text":"<p>By default, CodeCarbon saves emissions data locally. You can configure HTTP output to send data to your own endpoints. We do send data to our API when the user allows it and logs in. No data is sent to third parties without explicit configuration.</p>","path":["Introduction","Frequently Asked Questions"],"tags":[]},{"location":"introduction/faq/#what-hardware-does-codecarbon-support","level":2,"title":"What hardware does CodeCarbon support?","text":"<p>CodeCarbon supports various CPU architectures, GPUs, and cloud providers. For details on measurement priority and supported hardware, see the Methodology page.</p>","path":["Introduction","Frequently Asked Questions"],"tags":[]},{"location":"introduction/faq/#how-do-i-report-a-bug","level":2,"title":"How do I report a bug?","text":"<p>Please open an issue on GitHub with: - Your environment details - Steps to reproduce - Expected vs actual behavior</p>","path":["Introduction","Frequently Asked Questions"],"tags":[]},{"location":"introduction/methodology/","level":1,"title":"Methodology","text":"<p>Carbon dioxide (CO‚ÇÇ) emissions, expressed as kilograms of CO‚ÇÇ-equivalents (CO‚ÇÇeq), are the product of two main factors:</p> <pre><code>C = Carbon Intensity of the electricity consumed for computation: quantified as g of CO‚ÇÇ emitted per kilowatt-hour of electricity.\n\nE = Energy Consumed by the computational infrastructure: quantified as kilowatt-hours.\n</code></pre> <p>Carbon dioxide emissions (CO‚ÇÇeq) can then be calculated as <code>C * E</code></p>","path":["Introduction","Methodology"],"tags":[]},{"location":"introduction/methodology/#carbon-intensity","level":2,"title":"Carbon Intensity","text":"<p>Carbon Intensity of the consumed electricity is calculated as a weighted average of the emissions from the different energy sources that are used to generate electricity, including fossil fuels and renewables. In this toolkit, the fossil fuels coal, petroleum, and natural gas are associated with specific carbon intensities: a known amount of carbon dioxide is emitted for each kilowatt-hour of electricity generated. Renewable or low-carbon fuels include solar power, hydroelectricity, biomass, geothermal, and more. The nearby energy grid contains a mixture of fossil fuels and low-carbon energy sources, called the Energy Mix. Based on the mix of energy sources in the local grid, the Carbon Intensity of the electricity consumed can be computed.</p> <p></p> <p>When available, CodeCarbon uses global carbon intensity of electricity per cloud provider ( here) or per country ( here ).</p> <p>If we don't have the global carbon intensity or electricity of a country, but we have its electricity mix, we used to compute the carbon intensity of electricity using this table:</p> Energy Source Carbon Intensity (kg/MWh) Coal 995 Petroleum 816 Natural Gas 743 Geothermal 38 Hydroelectricity 26 Nuclear 29 Solar 48 Wind 26 <p>Carbon Intensity Across Energy Sources</p> <p>Sources:</p> <ul> <li>for fossil energies</li> <li>for renewables energies</li> </ul> <p>Then, for example, if the Energy Mix of the Grid Electricity is 25% Coal, 35% Petroleum, 26% Natural Gas and 14% Nuclear:</p> <pre><code>Net Carbon Intensity = 0.25 * 995 + 0.35 * 816 + 0.26 * 743 + 0.14 * 29 = 731.59 kgCO‚ÇÇ/kWh\n</code></pre> <p>But it doesn't happen anymore because Our World in Data now provides the global carbon intensity of electricity per country ( source ). Some countries are missing data for last year, so we use the previous year data available.</p> <p>If ever we have neither the global carbon intensity of a country nor its electricity mix, we apply a world average of 475 gCO2.eq/KWh ( source ).</p> <p>As you can see, we try to be as accurate as possible in estimating carbon intensity of electricity. Still there is room for improvement and all contributions are welcome.</p>","path":["Introduction","Methodology"],"tags":[]},{"location":"introduction/methodology/#power-usage","level":2,"title":"Power Usage","text":"<p>Power supply to the underlying hardware is tracked at frequent time intervals. This is a configurable parameter <code>measure_power_secs</code>, with default value 15 seconds, that can be passed when instantiating the emissions tracker.</p> <p>Currently, the package supports the following hardware infrastructure.</p>","path":["Introduction","Methodology"],"tags":[]},{"location":"introduction/methodology/#gpu","level":3,"title":"GPU","text":"<p>Tracks Nvidia GPUs energy consumption using <code>nvidia-ml-py</code> library (installed with the package).</p>","path":["Introduction","Methodology"],"tags":[]},{"location":"introduction/methodology/#ram","level":3,"title":"RAM","text":"<p>CodeCarbon v2 uses a 3 Watts for 8 GB ratio source .</p> <p>But this is not a good measure because it doesn't take into account the number of RAM slots used in the machine, that really drive the power consumption, not the amount of RAM. For example, in servers you could have thousands of GB of RAM but the power consumption would not be proportional to the amount of memory used, but to the number of memory modules used.</p> <p>Old machine could use 2 Mb memory stick, where modern servers will use 128 Mb memory stick.</p> <p>So, in CodeCarbon v3 we switch to using 5 Watts for each RAM slot. The energy consumption is calculated as follows:</p> <pre><code>RAM Power Consumption = 5 Watts * Number of RAM slots used\n</code></pre> <p>But getting the number of RAM slots used is not possible as you need root access to get the number of RAM slots used. So we use an heuristic based on the RAM size.</p> <p>For example keep a minimum of 2 modules. Except for ARM CPU like rapsberry pi where we will consider a 3W constant. Then consider the max RAM per module is 128GB and that RAM module only exist in power of 2 (2, 4, 8, 16, 32, 64, 128). So we can estimate the power consumption of the RAM by the number of modules used.</p> <ul> <li>For ARM CPUs (like Raspberry Pi), a constant 3W will be used as the     minimum power</li> <li>Base power per DIMM is 5W for x86 systems and 1.5W for ARM systems</li> <li>For standard systems (up to 4 DIMMs): linear scaling at full power     per DIMM</li> <li>For medium systems (5-8 DIMMs): decreasing efficiency (90% power per     additional DIMM)</li> <li>For large systems (9-16 DIMMs): further reduced efficiency (80%     power per additional DIMM)</li> <li>For very large systems (17+ DIMMs): highest efficiency (70% power     per additional DIMM)</li> <li>Ensures at least 10W for x86 systems (assuming 2 DIMMs at minimum)</li> <li>Ensures at least 3W for ARM systems</li> </ul> <p>Example Power Estimates:</p> <ul> <li>Small laptop (8GB RAM): ~10W (2 DIMMs at 5W each)</li> <li>Desktop (32GB RAM): ~20W (4 DIMMs at 5W each)</li> <li>Desktop (64GB RAM): ~20W (4 DIMMs at 5W each), the same as 32GB</li> <li>Small server (128GB RAM): ~40W (8 DIMMs with efficiency     scaling)</li> <li>Large server (1TB RAM): ~40W (using 8x128GB DIMMs with high     efficiency scaling)</li> </ul> <p>This approach significantly improves the accuracy for large servers by recognizing that RAM power consumption doesn't scale linearly with capacity, but rather with the number of physical modules. Since we don't have direct access to the actual DIMM configuration, this heuristic provides a more reasonable estimate than the previous linear model.</p> <p>If you know the exact RAM power consumption of your system, then provide it using the <code>force_ram_power</code> parameter, which will override the automatic estimation.</p> <p>For example, in a Ubuntu machine, you can get the number of RAM slots used with the following command:</p> <pre><code>sudo lshw -C memory -short | grep DIMM\n\n/0/37/0                                    memory         4GiB DIMM DDR4 Synchrone Unbuffered (Unregistered) 2400 MHz (0,4 ns)\n/0/37/1                                    memory         4GiB DIMM DDR4 Synchrone Unbuffered (Unregistered) 2400 MHz (0,4 ns)\n/0/37/2                                    memory         4GiB DIMM DDR4 Synchrone Unbuffered (Unregistered) 2400 MHz (0,4 ns)\n/0/37/3                                    memory         4GiB DIMM DDR4 Synchrone Unbuffered (Unregistered) 2400 MHz (0,4 ns)\n</code></pre> <p>Here we count 4 RAM slots used, so the power consumption will be 4 x 5 = 20 Watts, just add <code>force_ram_power=20</code> to the init of CodeCarbon.</p>","path":["Introduction","Methodology"],"tags":[]},{"location":"introduction/methodology/#cpu","level":3,"title":"CPU","text":"<ul> <li>On Windows or Mac (Intel)</li> </ul> <p>Tracks Intel processors energy consumption using the <code>Intel Power Gadget</code>. You need to install it yourself from this source . But has been discontinued. There is a discussion about it on github issues #457.</p> <ul> <li>Apple Silicon Chips (M1, M2)</li> </ul> <p>Apple Silicon Chips contain both the CPU and the GPU.</p> <p>Codecarbon tracks Apple Silicon Chip energy consumption using <code>powermetrics</code>. It should be available natively on any mac. However, this tool is only usable with <code>sudo</code> rights and to our current knowledge, there are no other options to track the energy consumption of the Apple Silicon Chip without administrative rights (if you know of any solution for this do not hesitate and open an issue with your proposed solution).</p> <p>To give sudo rights without having to enter a password each time, you can modify the sudoers file with the following command:</p> <pre><code>sudo visudo\n</code></pre> <p>Then add the following line at the end of the file:</p> <pre><code>username ALL = (root) NOPASSWD: /usr/bin/powermetrics\n</code></pre> <p>If you do not want to give sudo rights to your user, then CodeCarbon will fall back to constant mode to measure CPU energy consumption.</p> <ul> <li>On Linux</li> </ul> <p>Tracks Intel and AMD processor energy consumption from Intel RAPL files at <code>/sys/class/powercap/intel-rapl/subsystem</code> ( reference ). All CPUs listed in this directory will be tracked.</p> <p>Note: The Power Consumption will be tracked only if the RAPL files exist at the above-mentioned path and if the user has the necessary permissions to read them.</p>","path":["Introduction","Methodology"],"tags":[]},{"location":"introduction/methodology/#cpu-hardware","level":2,"title":"CPU hardware","text":"<p>The CPU die is the processing unit itself. It's a piece of semiconductor that has been sculpted/etched/deposited by various manufacturing processes into a net of logic blocks that do stuff that makes computing possible. The processor package is what you get when you buy a single processor. It contains one or more dies, plastic/ceramic housing for dies and gold-plated contacts that match those on your motherboard.</p> <p>In Linux kernel, energy_uj is a current energy counter in micro joules. It is used to measure CPU core's energy consumption.</p> <p>Micro joules is then converted in kWh, with formula <code>kWh=energy * 10** (-6) * 2.77778e-7</code>.</p> <p>For example, on a laptop with Intel(R) Core(TM) i7-7600U, Code Carbon will read two files : /sys/class/powercap/intel-rapl/intel-rapl:1/energy_uj and /sys/class/powercap/intel-rapl/intel-rapl:0/energy_uj</p>","path":["Introduction","Methodology"],"tags":[]},{"location":"introduction/methodology/#rapl-metrics","level":2,"title":"RAPL Metrics","text":"<p>RAPL (Running Average Power Limit) is a feature of modern processors that provides energy consumption measurements through hardware counters.</p> <p>See https://blog.chih.me/read-cpu-power-with-RAPL.html for more information.</p> <p>Despite the name \"Intel RAPL\", it supports AMD processors since Linux kernel 5.8.</p> <p>Read more about how we use it in RAPL Metrics.</p>","path":["Introduction","Methodology"],"tags":[]},{"location":"introduction/methodology/#cpu-metrics-priority","level":2,"title":"CPU metrics priority","text":"<p>CodeCarbon will first try to read the energy consumption of the CPU from low level interface like RAPL or <code>powermetrics</code>. If none of the tracking tools are available, CodeCarbon will be switched to a fallback mode:</p> <ul> <li>It will first detect which CPU hardware is currently in use, and     then map it to a data source listing 2000+ Intel and AMD CPUs and     their corresponding thermal design powers (TDPs).</li> <li>If the CPU is not found in the data source, a global constant will     be applied.</li> <li>If <code>psutil</code> is available, CodeCarbon will try to estimate the energy     consumption from the TDP and the CPU load.</li> <li>CodeCarbon assumes that 50% of the TDP will be the average power     consumption to make this approximation.</li> </ul> <p>Here is a drawing of the fallback mode:</p> <p></p> <p>The code doing this is available in codecarbon/core/resource_tracker.py.</p> <p>The net Energy Used is the net power supply consumed during the compute time, measured as <code>kWh</code>.</p> <p>We compute energy consumption as the product of the power consumed and the time the power was consumed for. The formula is: <code>Energy = Power * Time</code></p>","path":["Introduction","Methodology"],"tags":[]},{"location":"introduction/methodology/#references","level":2,"title":"References","text":"<p>Energy Usage Reports: Environmental awareness as part of algorithmic accountability</p>","path":["Introduction","Methodology"],"tags":[]},{"location":"introduction/methodology/#how-codecarbon-works","level":3,"title":"How CodeCarbon Works","text":"<p>CodeCarbon uses a scheduler that, by default, calls for a measure every 15 seconds, so it has no significant overhead.</p> <p>The measure itself is fast and CodeCarbon is designed to be as light as possible with a small memory footprint.</p> <p>The scheduler is started when the first <code>start</code> method is called and stopped when <code>stop</code> method is called.</p> <p>Another scheduler (<code>scheduler_monitor_power</code>) is used to monitor only the power consumption of the hardware every second. It is needed for hardware that do not have energy counters but only instant power, like in CPU load mode.</p>","path":["Introduction","Methodology"],"tags":[]},{"location":"introduction/methodology/#estimation-of-equivalent-usage-emissions","level":2,"title":"Estimation of Equivalent Usage Emissions","text":"<p>The CodeCarbon dashboard provides equivalent emissions and energy usage comparisons to help users better understand the carbon impact of their activities. These comparisons are based on the following assumptions:</p>","path":["Introduction","Methodology"],"tags":[]},{"location":"introduction/methodology/#car-usage","level":3,"title":"Car Usage","text":"<ul> <li>Emission factor: 0.12 kgCO‚ÇÇ per kilometer driven.</li> <li>This value is derived from the average emissions of a European     passenger car under normal driving conditions.</li> </ul> <p>Source : European Environment Agency</p>","path":["Introduction","Methodology"],"tags":[]},{"location":"introduction/methodology/#tv-usage","level":3,"title":"TV Usage","text":"<ul> <li>Energy consumption: 138 Wh per day based on average use.</li> <li>This assumes:<ul> <li>An average daily usage of 6.5 hours.</li> <li>A modern television with a power consumption of approximately     21.2 W per hour.</li> </ul> </li> </ul> <p>Source : The French Agency for Ecological Transition</p>","path":["Introduction","Methodology"],"tags":[]},{"location":"introduction/methodology/#us-citizen-weekly-emissions","level":3,"title":"US Citizen Weekly Emissions","text":"<ul> <li>Annual emissions: 13.3 tons of CO‚ÇÇ equivalent per year for an     average US citizen.</li> <li>Weekly emissions: This value is divided by the 52 weeks in a     year to estimate weekly emissions:</li> </ul> \\[\\text{Weekly Emissions} = \\frac{\\text{Annual Emissions (tons)}}{52}\\] \\[\\text{Weekly Emissions} = \\frac{13.3}{52} \\approx 0.256 \\, \\text{tons of CO‚ÇÇ equivalent per week.}\\] <p>Source : IEA CO2 total emissions per capita by region, 2000-2023</p>","path":["Introduction","Methodology"],"tags":[]},{"location":"introduction/methodology/#calculation-formula","level":3,"title":"Calculation Formula","text":"<p>The equivalent emissions are calculated using this formula:</p> \\[\\text{Equivalent Emissions} = \\frac{\\text{Total Emissions (kgCO‚ÇÇ)}}{\\text{Emission Factor (kgCO‚ÇÇ/unit)}}\\] <p>For example:</p> <ul> <li>Car Usage: 1 kWh of energy consumption is approximately     equivalent to:<ul> <li>8.33 kilometers driven by a car (1 √∑ 0.12).</li> <li>11.9 hours of TV usage (1 √∑ 0.084), if emissions are     considered.</li> </ul> </li> <li>US Citizen Emissions:<ul> <li>1 kWh of energy consumption can be compared to a fraction of     the average weekly emissions of a US citizen:</li> </ul> </li> </ul> \\[\\text{US Citizen Equivalent} = \\frac{\\text{Total Emissions (tons)}}{0.256}\\] <p>These estimates are approximate and subject to regional variations in:</p> <ul> <li>Grid emissions intensity.</li> <li>Vehicle efficiencies.</li> </ul>","path":["Introduction","Methodology"],"tags":[]},{"location":"introduction/methodology/#source-code","level":3,"title":"Source Code","text":"<p>The emission factors used are defined in the CodeCarbon source code. They are based on publicly available data and general assumptions.</p>","path":["Introduction","Methodology"],"tags":[]},{"location":"introduction/model_examples/","level":1,"title":"Model Comparisons","text":"<p>The following table shows the different electricity consumption of popular NLP and Computer Vision models:</p> Model GPU Training Time (H) Consumption (kWh) BERT fintetune 4 V100 6 3.1 BERT pretrain 8 V100 36 37.3 6B Transf. 256 A100 192 13,812.4 Dense 121 1 P40 0.3 0.02 Dense 169 1 P40 0.3 0.03 Dense 201 1 P40 0.4 0.04 ViT Tiny 1 V100 19 1.7 ViT Small 1 V100 19 2.2 ViT Base 1 V100 21 4.7 ViT Large 4 V100 90 93.3 ViT Huge 4 V100 216 237.6 <p>Electricity consumption of AI cloud instance</p>","path":["Introduction","Model Comparisons"],"tags":[]},{"location":"introduction/model_examples/#impact-of-time-of-year-and-region","level":2,"title":"Impact of time of year and region","text":"<p>Carbon emissions that would be emitted from training BERT (language modeling on 8 V100s for 36 hours) in different locations:</p> <p></p> <p>In this case study, time of year might not be relevant in most cases, but localisation can have a great impact on carbon emissions.</p> <p>Here, and in the graph below, emissions equivalent are estimated using Microsoft Azure cloud tools. CodeCarbon has developed its own measuring tools. The result could be different.</p>","path":["Introduction","Model Comparisons"],"tags":[]},{"location":"introduction/model_examples/#comparisons","level":2,"title":"Comparisons","text":"<p>Emissions for the 11 described models can be displayed as below:</p> <p></p> <p>The black line represents the average emissions (across regions and time of year). The light blue represents the first and fourth quartiles. On the right side, equivalent sources of emissions are displayed as comparison points (source : US Environmental Protection Agency). NB : presented on a log scale</p>","path":["Introduction","Model Comparisons"],"tags":[]},{"location":"introduction/model_examples/#references","level":2,"title":"References","text":"<p>Measuring the Carbon intensity of AI in Cloud Instance</p> <p>Another source comparing models carbon intensity: Energy and Policy Considerations for Deep Learning in NLP</p>","path":["Introduction","Model Comparisons"],"tags":[]},{"location":"introduction/motivation/","level":1,"title":"Motivation","text":"<p>AI can benefit society in many ways, but given the energy needed to support the computing behind AI, these benefits can come at a high environmental price. Use CodeCarbon to track and reduce your CO‚ÇÇ output from local computing‚Äîtraining, inference on your own hardware, or any code on machines you control. For tracking emissions from remote GenAI API calls, see EcoLogits.</p>","path":["Introduction","Motivation"],"tags":[]},{"location":"introduction/motivation/#computer-emits-co2-we-started-measuring-how-much","level":2,"title":"Computer emits CO‚ÇÇ. We started measuring how much","text":"<p>A single datacenter can consume large amounts of energy to run computing code. An innovative new tracking tool is designed to measure the climate impact of artificial intelligence.</p> <p>Kana Lottick, Silvia Susai, Sorelle Friedler, and Jonathan Wilson. Energy Usage Reports: Environmental awareness as part of algorithmic accountability. NeurIPS Workshop on Tackling Climate Change with Machine Learning, 2019.</p>","path":["Introduction","Motivation"],"tags":[]},{"location":"introduction/motivation/#why-track-emissions","level":2,"title":"Why track emissions?","text":"<p>In recent years, Artificial Intelligence, and more specifically Machine Learning, has become remarkably efficient at performing human-level tasks: recognizing objects and faces in images, driving cars, and playing sophisticated games like chess and Go.</p> <p>In order to achieve these incredible levels of performance, current approaches leverage vast amounts of data to learn underlying patterns and features. Thus, state-of-the-art Machine Learning models leverage significant amounts of computing power, training on advanced processors for weeks or months, consequently consuming enormous amounts of energy. Depending on the energy grid used during this process, this can entail the emission of large amounts of greenhouse gases such as CO‚ÇÇ.</p> <p>With AI models becoming more ubiquitous and deployed across different sectors and industries, AI's environmental impact is also growing. For this reason, it is important to estimate and curtail both the energy used and the emissions produced by training and deploying AI models. This package enables developers to track carbon dioxide (CO‚ÇÇ) emissions across machine learning experiments or other programs.</p>","path":["Introduction","Motivation"],"tags":[]},{"location":"introduction/motivation/#co2-equivalents","level":2,"title":"CO‚ÇÇ-equivalents","text":"<p>This package enables developers to track emissions, measured as kilograms of CO‚ÇÇ-equivalents (CO‚ÇÇeq) in order to estimate the carbon footprint of their work. We use CO‚ÇÇ-equivalents [CO‚ÇÇeq], which is a standardized measure used to express the global warming potential of various greenhouse gases: the amount of CO‚ÇÇ that would have the equivalent global warming impact. For computing, which emits CO‚ÇÇ via the electricity it consumes, carbon emissions are measured in kilograms of CO‚ÇÇ-equivalent per kilowatt-hour. Electricity is generated as part of the broader electrical grid by combusting fossil fuels, for example.</p>","path":["Introduction","Motivation"],"tags":[]},{"location":"introduction/rapl/","level":1,"title":"RAPL Metrics","text":"<p>RAPL (Running Average Power Limit) is a feature of modern processors that provides energy consumption measurements through hardware counters.</p> <p>See https://blog.chih.me/read-cpu-power-with-RAPL.html for more information.</p> <p>Despite the name \"Intel RAPL\", it supports AMD processors since Linux kernel 5.8.</p> <p>Due to the CVE-2020-8694 security issue from 2020, all Linux distributions have changed right permission of the RAPL file, to reserve it to superuser.</p> <p>There is a workaround, thanks to prometheus/node_exporter#1892:</p> <pre><code>sudo apt install sysfsutils\nnano /etc/sysfs.conf\n# Add this line :\nmode class/powercap/intel-rapl:0/energy_uj = 0444\nreboot\n</code></pre> <p>Without rebooting you could do <code>sudo chmod -R a+r /sys/class/powercap/*</code> but it will be lost at next boot.</p> <p>If you want more security you could create a specific group, add your user to this group and set group read permission only.</p>","path":["Introduction","RAPL Metrics"],"tags":[]},{"location":"introduction/rapl/#rapl-domain-architecture","level":2,"title":"RAPL Domain Architecture","text":"<p>RAPL exposes energy consumption data through files in <code>/sys/class/powercap/</code> with two interfaces:</p> <ul> <li>intel-rapl (MSR-based): Traditional Model-Specific Register     interface, accessed via CPU instructions</li> <li>intel-rapl-mmio (Memory-Mapped I/O): Newer interface introduced     for modern Intel processors (10<sup>th</sup> gen+)</li> </ul> <p>Each domain is represented by a directory containing:</p> <ul> <li><code>name</code>: Domain identifier (e.g., \"package-0\", \"core\",     \"uncore\", \"psys\")</li> <li><code>energy_uj</code>: Current energy counter in microjoules</li> <li><code>max_energy_range_uj</code>: Maximum value before counter wraps</li> </ul>","path":["Introduction","RAPL Metrics"],"tags":[]},{"location":"introduction/rapl/#available-rapl-domains","level":2,"title":"Available RAPL Domains","text":"<p>Different CPUs expose different domains. Common domains include:</p> <ul> <li>psys (Platform/System): Total platform power including CPU     package, integrated GPU, memory controller, and some chipset     components. Most comprehensive measurement on modern Intel     systems (Skylake and newer).</li> <li>package-0/package-N: Entire CPU socket including:<ul> <li>All CPU cores</li> <li>Integrated GPU (if present)</li> <li>Last-level cache (LLC)</li> <li>Memory controller</li> <li>System agent/uncore</li> </ul> </li> <li>core: Only the CPU compute cores (subset of package)</li> <li>uncore: Everything in the package except cores:<ul> <li>Memory controller (DDR interface on CPU)</li> <li>Last-level cache</li> <li>Ring interconnect between cores</li> <li>Integrated GPU (if present)</li> </ul> </li> <li>dram: Memory controller power, rare on consumer hardware, more     common on servers. We still have to figure out if it is accurate.</li> <li>gpu: Discrete or integrated GPU (when available)</li> </ul>","path":["Introduction","RAPL Metrics"],"tags":[]},{"location":"introduction/rapl/#rapl-domain-hierarchy-and-double-counting","level":2,"title":"RAPL Domain Hierarchy and Double-Counting","text":"<p>Critical: RAPL domains are hierarchical and overlapping. Summing them causes severe over-counting!</p> <p>Example hierarchy on Intel Core Ultra 7 265H:</p> <pre><code>psys (9.6W) ‚Üê Most comprehensive, includes everything below\n‚îú‚îÄ‚îÄ package-0 (3.8W) ‚Üê Subset of psys\n‚îÇ   ‚îú‚îÄ‚îÄ core (0.8W) ‚Üê Subset of package\n‚îÇ   ‚îî‚îÄ‚îÄ uncore (0.2W) ‚Üê Subset of package\n‚îî‚îÄ‚îÄ Other platform components (~5W)\n    ‚îî‚îÄ‚îÄ Chipset, PCIe, etc.\n</code></pre> <p>Wrong approach: 9.6W + 3.8W + 0.8W + 0.2W = 14.4W ‚ùå (Triple counting!)</p> <p>Correct approach: Use only psys (9.6W) ‚úÖ</p>","path":["Introduction","RAPL Metrics"],"tags":[]},{"location":"introduction/rapl/#codecarbons-rapl-strategy","level":2,"title":"CodeCarbon's RAPL Strategy","text":"<p>CodeCarbon implements intelligent domain selection to provide reliable and consistent measurements:</p> <ol> <li>Prefer package domains (default): CodeCarbon prioritizes     <code>package</code> domains because they:<ul> <li>Update reliably under CPU load</li> <li>Match CPU TDP specifications</li> <li>Provide consistent measurements across different Intel     generations</li> <li>Can be supplemented with <code>dram</code> domains for complete hardware     measurement (package + DRAM)</li> </ul> </li> <li>Optional psys mode: Set <code>prefer_psys=True</code> to use <code>psys</code>     (platform/system) domain instead:<ul> <li>Provides total platform power (CPU + chipset + PCIe + some other     components)</li> <li>More comprehensive but can report higher values than CPU TDP</li> <li>May include non-CPU components affected by the computation</li> <li>Note: On some older Intel systems (e.g., Kaby Lake), psys     can report unexpectedly high values</li> </ul> </li> <li>Interface deduplication: When the same domain appears in both     <code>intel-rapl</code> and <code>intel-rapl-mmio</code>:<ul> <li>Detects duplicate domains by name</li> <li>Prefers MMIO over MSR (newer, recommended interface)</li> <li>Falls back to MSR if MMIO is unreadable</li> </ul> </li> <li>Subdomain filtering: Excludes <code>core</code> and <code>uncore</code> subdomains     when <code>package</code> is available to avoid double-counting</li> <li>DRAM exclusion: By default (<code>include_dram=False</code>), don't add     DRAM domain to package. As DRAM is supposed to be in RAM power, not     CPU in a future version of CodeCarbon.</li> </ol>","path":["Introduction","RAPL Metrics"],"tags":[]},{"location":"introduction/rapl/#platform-specific-behavior","level":2,"title":"Platform-Specific Behavior","text":"<p>Intel processors:</p> <ul> <li>Modern CPUs (Skylake+): Provide <code>psys</code> for comprehensive platform     measurement</li> <li><code>core</code> is included in <code>package</code></li> <li><code>package</code> may include or exclude integrated GPU depending on model</li> </ul> <p>AMD processors:</p> <ul> <li><code>core</code> reports very low energy values</li> <li>Unclear if <code>core</code> is included in <code>package</code> (vendor documentation is     sparse)</li> <li>Multiple dies may report as separate packages (e.g., Threadripper)</li> </ul> <p>What RAPL Does NOT Measure:</p> <ul> <li>‚ùå DRAM chips themselves (only memory controller)</li> <li>‚ùå SSDs/NVMe drives</li> <li>‚ùå Discrete GPUs (use nvidia-smi, rocm-smi separately)</li> <li>‚ùå Motherboard chipset (unless included in psys)</li> <li>‚ùå Fans, USB devices, peripherals</li> <li>‚ùå Power supply inefficiency</li> <li>‚ùå Discrete NPUs</li> </ul> <p>For more details, see the excellent documentation from Scaphandre: https://hubblo-org.github.io/scaphandre-documentation/explanations/rapl-domains.html and discussion with references: https://github.com/hubblo-org/scaphandre/issues/116#issuecomment-854453231</p> <p></p> <p>Source :\"RAPL in Action: Experiences in Using RAPL for Power Measurements,\" (K. N. Khan, M. Hirki, T. Niemi, J. K. Nurminen, and Z. Ou, ACM Trans. Model. Perform. Eval. Comput. Syst., vol. 3, no. 2, pp. 1--26, Apr. 2018, doi: 10.1145/3177754.)</p>","path":["Introduction","RAPL Metrics"],"tags":[]},{"location":"introduction/rapl/#rapl-measurements-real-world-examples","level":2,"title":"RAPL Measurements: Real-World Examples","text":"<p>Choosing the right metric to track CPU power consumption depends on CPU hardware and available domains. Below are measurements from different systems showing the importance of avoiding double-counting.</p> <p>We investigate RAPL on various architectures :</p> <ul> <li>2017 Gaming computer with AMD Ryzen Threadripper 1950X</li> <li>2017 Laptop with Intel(R) Core(TM) i7-7600U (TDP 15W)</li> <li>2025 Laptop with Intel(R) Core(TM) Ultra 7 265H (TDP 28W)</li> </ul> <pre><code>Desktop computer with AMD Ryzen Threadripper 1950X 16-Core (32 threads)\nPower plug measure when idle (10% CPU): 125 W\npackage-0-die-0: 68 W | package-0-die-1: 68 W | CodeCarbon: 137 W\n</code></pre>","path":["Introduction","RAPL Metrics"],"tags":[]},{"location":"introduction/rapl/#laptop-intelr-coretm-ultra-7-265h-tdp-28w","level":3,"title":"Laptop: Intel(R) Core(TM) Ultra 7 265H (TDP 28W)","text":"<p>Idle Measurements:</p> <pre><code>Powertop battery discharge rate: 6W\n\nRAPL domains (individual readings):\n- psys (platform):    6.66W  ‚Üê Total platform power (BEST)\n- package-0:          3.85W  ‚Üê CPU package (subset of psys)\n- core:               0.35W  ‚Üê CPU cores only (subset of package)\n- uncore:             0.02W  ‚Üê Memory controller, cache (subset of package)\n\n‚ö†Ô∏è  WRONG: Summing all domains = 10.88W (over-counting!)\n‚úÖ  CORRECT: Use psys only = 6.66W (matches battery discharge)\n</code></pre> <p>CodeCarbon behavior: Uses psys only (6.66W) to avoid double-counting.</p> <p>Under Load (stress-ng):</p> <pre><code>Powertop battery discharge rate: 27W\n\nRAPL domains:\n- psys:               24.69W  ‚Üê Total platform power (BEST)\n- package-0:          21.35W  ‚Üê CPU package (subset of psys)\n- core:               15.37W  ‚Üê CPU cores (subset of package)\n- uncore:              0.07W  ‚Üê Uncore (subset of package)\n\n‚úÖ  CORRECT: Use psys only = 24.69W (close to battery discharge)\n</code></pre> <p>CodeCarbon measurement: 22W using psys (accurate, within expected range)</p> <p>Note: The package-0 measurement (21.35W) excludes some platform components like chipset and PCIe that are included in psys (24.69W).</p>","path":["Introduction","RAPL Metrics"],"tags":[]},{"location":"introduction/rapl/#laptop-intelr-coretm-i7-7600u-tdp-15w-7th-gen-kaby-lake","level":3,"title":"Laptop: Intel(R) Core(TM) i7-7600U (TDP 15W, 7<sup>th</sup> Gen Kaby Lake)","text":"<p>Idle Measurements:</p> <pre><code>Powertop battery discharge rate: 9.31W\n\nRAPL domains:\n- psys:              12.21W  ‚Üê Total platform power (includes everything)\n- package-0:          1.44W  ‚Üê CPU package only\n- core:               0.46W  ‚Üê CPU cores (subset of package)\n- uncore:             0.04W  ‚Üê Uncore (subset of package)\n- dram:               0.54W  ‚Üê Memory controller (may overlap with uncore)\n\n‚ö†Ô∏è  WRONG: Summing all = 14.69W (triple counting!)\n‚úÖ  CORRECT: Use psys = 12.21W\n</code></pre> <p>Under Load (stress-ng):</p> <pre><code>Powertop battery discharge rate: 8.40W (unreliable during stress test)\n\nRAPL domains:\n- psys:              29.97W  ‚Üê Total platform power (BEST)\n- package-0:         15.73W  ‚Üê CPU package (matches TDP, subset of psys)\n- core:              14.00W  ‚Üê CPU cores (subset of package)\n- uncore:             0.54W  ‚Üê Uncore (subset of package)\n- dram:               1.23W  ‚Üê Memory controller power\n\n‚ö†Ô∏è  WRONG: Summing all = 61.47W (massive over-counting!)\n‚úÖ  CORRECT: Use psys = 29.97W\n\nAnalysis:\n- psys (29.97W) includes package (15.73W) + platform components (~14W)\n- package (15.73W) includes core (14.00W) + uncore (0.54W) + other\n- Core power (14.00W) matches the CPU TDP spec (15W)\n</code></pre> <p>CodeCarbon behavior: Uses psys only (29.97W) for accurate total platform measurement.</p> <p>Legacy behavior (before v2.x): Would have measured only package-0 (15.73W), missing ~14W of platform power!</p>","path":["Introduction","RAPL Metrics"],"tags":[]},{"location":"introduction/rapl/#desktop-amd-ryzen-threadripper-1950x-16-core-32-threads-multi-die","level":3,"title":"Desktop: AMD Ryzen Threadripper 1950X (16-Core, 32 threads, Multi-die)","text":"<p>Idle Measurements (10% CPU load):</p> <pre><code>Wall power meter: 100W (whole system)\n\n\nRAPL domains:\n    Monitoring domains:\n    - core (intel-rapl:0:0) via MSR\n    - package-0 (intel-rapl:0) via MSR\n\n    Domain 'core' (MSR): 0.61 Watts\n    Domain 'package-0' (MSR): 29.76 Watts\n    Total Power Consumption: 30.37 Watts\n\n    Domain 'core' (MSR): 0.20 Watts\n    Domain 'package-0' (MSR): 38.62 Watts\n    Total Power Consumption: 38.82 Watts\n\n[codecarbon INFO @ 22:24:44]    RAPL - Monitoring domain 'package-0' (displayed as 'Processor Energy Delta_0(kWh)') via MSR at /sys/class/powercap/intel-rapl/subsystem/intel-rapl/intel-rapl:0/energy_uj\n\n‚úÖ  CodeCarbon total: ~ 40 W\n\nNote: RAPL on this system measures only the CPU dies, not platform.\nWall power includes motherboard, RAM, fans, PSU losses.\n</code></pre> <p>Under Full Load (100% CPU, stress test):</p> <pre><code>Wall power meter: ~ 280 W total (131W above idle baseline)\n\nMonitoring domains:\n- core (intel-rapl:0:0) via MSR\n- package-0 (intel-rapl:0) via MSR\n\nDomain 'core' (MSR): 8.86 Watts\nDomain 'package-0' (MSR): 172.50 Watts\nTotal Power Consumption: 181.36 Watts\n\nDomain 'core' (MSR): 8.88 Watts\nDomain 'package-0' (MSR): 172.16 Watts\nTotal Power Consumption: 181.05 Watts\n\n‚úÖ  CodeCarbon total: 171 W, in line with the TDP of 180 W\n280 - 100 (idle) = 180 W\n\nAnalysis:\n- Each die independently measured via RAPL\n- No psys domain available on this AMD system\n- RAPL counter range: 234 sec at 280W (potential wraparound consideration)\n</code></pre> <p>AMD RAPL Characteristics:</p> <ul> <li>Multi-die CPUs report separate packages (package-0-die-0,     package-0-die-1)</li> <li>No psys domain available on older AMD processors</li> <li><code>core</code> domain reports very low values (unclear if included in     package)</li> <li>Package measurements are generally reliable for total CPU power</li> </ul>","path":["Introduction","RAPL Metrics"],"tags":[]},{"location":"introduction/rapl/#key-takeaways-for-rapl-measurements","level":2,"title":"Key Takeaways for RAPL Measurements","text":"<ol> <li>CodeCarbon defaults to package domains: This provides the most     reliable and consistent measurements that match CPU TDP     specifications. Package domains update correctly under load across     all Intel generations.</li> <li>psys can be unreliable: While <code>psys</code> provides total platform     power, it:<ul> <li>Can report higher values than expected (includes chipset, PCIe,     etc.)</li> <li>May not include all CPU components on older Intel systems : on     some computers, <code>psys</code> is lower than <code>package</code>.</li> <li>So it is disabled by default, you can enable it with     <code>prefer_psys=True</code> if desired</li> </ul> </li> <li>Avoid summing overlapping domains: Never sum psys + package +     core + uncore. They are hierarchical and overlapping. This causes     2-3x over-counting!</li> <li>Domain hierarchy:<ul> <li>psys ‚äÉ package ‚äÉ {core, uncore}</li> <li>Correct: Use package alone (CodeCarbon default) OR psys alone     (with prefer_psys=True)</li> <li>Wrong: Sum multiple levels</li> </ul> </li> <li>Interface deduplication: The same domain may appear in both     <code>intel-rapl</code> (MSR) and <code>intel-rapl-mmio</code> interfaces. CodeCarbon     automatically deduplicates, preferring MMIO.</li> <li>DRAM measurement: CodeCarbon does not include DRAM domains by     default (<code>include_dram=False</code>) for CPU hardware measurement. Set     <code>include_dram=True</code> to measure CPU package + DRAM domains.</li> <li>Platform-specific behavior:<ul> <li>Intel modern: package or psys (with prefer_psys=True)</li> <li>Intel older: package-0 for CPU only</li> <li>AMD: Sum all package-X-die-Y for multi-die CPUs</li> </ul> </li> <li>Limitations: RAPL does NOT measure:<ul> <li>Discrete GPUs (use nvidia-smi/rocm-smi)</li> <li>SSDs, peripherals, fans</li> <li>Actual DRAM chips, we still have to investigate on this point</li> <li>Complete system power (use wall meter for accuracy)</li> </ul> </li> </ol>","path":["Introduction","RAPL Metrics"],"tags":[]},{"location":"introduction/when-to-use/","level":1,"title":"When to use CodeCarbon","text":"<p>CodeCarbon tracks carbon emissions from local computing‚Äîcode that runs on hardware you control.</p>","path":["Introduction","When to use CodeCarbon"],"tags":[]},{"location":"introduction/when-to-use/#use-codecarbon-when-you","level":2,"title":"Use CodeCarbon when you","text":"<ul> <li>Train models on your machine, server, or cloud VM</li> <li>Run inference on your own hardware (laptop, GPU server, on-prem)</li> <li>Execute any code that consumes electricity on infrastructure you control</li> </ul> <p>CodeCarbon measures actual power consumption (CPU, GPU, RAM) and converts it to CO‚ÇÇ emissions using grid carbon intensity.</p>","path":["Introduction","When to use CodeCarbon"],"tags":[]},{"location":"introduction/when-to-use/#use-ecologits-when-you","level":2,"title":"Use EcoLogits when you","text":"<ul> <li>Call GenAI APIs (OpenAI, Anthropic, Mistral, Hugging Face, etc.)</li> <li>Don't control the hardware‚Äîthe model runs on the provider's infrastructure</li> <li>Want to estimate the environmental impact of API requests from request metadata</li> </ul> <p>EcoLogits estimates impacts from API calls without access to the underlying hardware.</p>","path":["Introduction","When to use CodeCarbon"],"tags":[]},{"location":"introduction/when-to-use/#both-are-complementary","level":2,"title":"Both are complementary","text":"<p>Use CodeCarbon for training and local inference. Use EcoLogits for remote API inference. Together they cover the full lifecycle of AI workloads.</p>","path":["Introduction","When to use CodeCarbon"],"tags":[]},{"location":"logging/output/","level":1,"title":"Output","text":"","path":["Logging","Output"],"tags":[]},{"location":"logging/output/#csv","level":2,"title":"CSV","text":"<p>The package has an in-built logger that logs data into a CSV file named <code>emissions.csv</code> in the <code>output_dir</code>, provided as an input parameter (defaults to the current directory), for each experiment tracked across projects.</p> Field Description timestamp Time of the experiment in <code>%Y-%m-%dT%H:%M:%S</code> format project_name Name of the project, defaults to <code>codecarbon</code> run_id ID of the run duration Duration of the compute, in seconds emissions Emissions as CO‚ÇÇ-equivalents (CO‚ÇÇeq), in kg emissions_rate Emissions divided per duration, in Kg/s cpu_power Mean CPU power (W) gpu_power Mean GPU power (W) ram_power Mean RAM power (W) cpu_energy Energy used per CPU (kWh) gpu_energy Energy used per GPU (kWh) ram_energy Energy used per RAM (kWh) energy_consumed Sum of cpu_energy, gpu_energy and ram_energy (kWh) country_name Name of the country where the infrastructure is hosted country_iso_code 3-letter alphabet ISO Code of the respective country region Province/State/City where the compute infrastructure is hosted on_cloud <code>Y</code> if on cloud, <code>N</code> for private infrastructure cloud_provider One of aws/azure/gcp cloud_region Geographical region (e.g., us-east-2 for aws, brazilsouth for azure, asia-east1 for gcp) os Operating system (e.g., Windows-10-10.0.19044-SP0) python_version Python version (e.g., 3.8.10) codecarbon_version Version of codecarbon used cpu_count Number of CPUs cpu_model Example: Intel(R) Core(TM) i7-1065G7 CPU @ 1.30GHz gpu_count Number of GPUs gpu_model Example: 1 x NVIDIA GeForce GTX 1080 Ti longitude Longitude, with reduced precision to a range of 11.1 km / 123 km¬≤ (privacy protection) latitude Latitude, with reduced precision to a range of 11.1 km / 123 km¬≤ (privacy protection) ram_total_size Total RAM available (GB) tracking_mode <code>machine</code> or <code>process</code> (default: <code>machine</code>) cpu_utilization_percent Average CPU utilization during tracking period (%) gpu_utilization_percent Average GPU utilization during tracking period (%) ram_utilization_percent Average RAM utilization during tracking period (%) ram_used_gb Average RAM used during tracking period (GB) <p>Note</p> <p>Developers can enhance the Output interface by implementing a custom class that extends <code>BaseOutput</code> at <code>codecarbon/output.py</code>. For example, to log into a database.</p>","path":["Logging","Output"],"tags":[]},{"location":"logging/output/#prometheus","level":2,"title":"Prometheus","text":"<p>Prometheus is a systems and service monitoring system. It collects metrics from configured targets at given intervals, evaluates rule expressions, displays the results, and can trigger alerts when specified conditions are observed.</p> <p>CodeCarbon exposes all its metrics with the suffix <code>codecarbon_</code>.</p> <p>Current version uses pushgateway mode. If your pushgateway server needs auth, set your environment variables <code>PROMETHEUS_USERNAME</code> and <code>PROMETHEUS_PASSWORD</code> so CodeCarbon can push the metrics.</p>","path":["Logging","Output"],"tags":[]},{"location":"logging/output/#how-to-test-locally","level":3,"title":"How to test locally","text":"<p>Deploy a local version of Prometheus + Prometheus Pushgateway:</p> <pre><code>docker-compose up\n</code></pre> <p>Run your EmissionsTracker as usual, with <code>save_to_prometheus=True</code>:</p> <pre><code>tracker = OfflineEmissionsTracker(\n    project_name=\"my_project\",\n    country_iso_code=\"USA\",\n    save_to_prometheus=True,\n)\ntracker.start()\n# Your code here\ntracker.stop()\n</code></pre> <p>Go to localhost:9090. Search for <code>codecarbon_</code> to see all metrics.</p>","path":["Logging","Output"],"tags":[]},{"location":"logging/output/#logfire","level":2,"title":"Logfire","text":"<p>Logfire is an observability platform.</p> <p>CodeCarbon exposes all its metrics with the suffix <code>codecarbon_</code>.</p>","path":["Logging","Output"],"tags":[]},{"location":"logging/output/#how-to-use-it","level":3,"title":"How to use it","text":"<p>Run your EmissionsTracker as usual, with <code>save_to_logfire=True</code>:</p> <pre><code>tracker = OfflineEmissionsTracker(\n    project_name=\"my_project\",\n    country_iso_code=\"USA\",\n    save_to_logfire=True,\n)\ntracker.start()\n# Your code here\ntracker.stop()\n</code></pre> <p>The first time it will ask you to log in to Logfire. Once you log in and set the default Logfire project, the metrics will appear following the format <code>codecarbon_*</code>.</p>","path":["Logging","Output"],"tags":[]},{"location":"logging/output/#http-output","level":2,"title":"HTTP Output","text":"<p>The HTTP Output allows calling a webhook with emission data when the tracker is stopped. Use the <code>emissions_endpoint</code> parameter to specify your endpoint.</p>","path":["Logging","Output"],"tags":[]},{"location":"logging/output/#codecarbon-api","level":2,"title":"CodeCarbon API","text":"<p>You can send all your data to the CodeCarbon API so you have your historical data in one place. By default, nothing is sent to the API. Use <code>save_to_api=True</code> and configure your API credentials.</p>","path":["Logging","Output"],"tags":[]},{"location":"logging/output/#logger-output","level":2,"title":"Logger Output","text":"<p>See Collecting emissions to a logger.</p>","path":["Logging","Output"],"tags":[]},{"location":"logging/to_logger/","level":1,"title":"Collecting emissions to a logger","text":"<p>The <code>LoggerOutput</code> class (and <code>GoogleCloudLoggerOutput</code> subclass) allows you to send emissions tracking to a logger. This is a specific, distinct logger than the one used by the CodeCarbon package for its private logs. It allows you to leverage powerful logging systems, to centralize emissions to some central or cloud-based system, and build reports, triggers, etc. based on these data.</p> <p>This logging output can be used in parallel with other output options provided by CodeCarbon.</p>","path":["Logging","Collecting emissions to a logger"],"tags":[]},{"location":"logging/to_logger/#create-a-logger","level":2,"title":"Create a logger","text":"<p>In order to send emissions tracking data to the logger, first create a logger and then create an <code>EmissionsTracker</code>. <code>OfflineEmissionsTracker</code> is also supported but lack of network connectivity may forbid to stream tracking data to some central or cloud-based collector.</p>","path":["Logging","Collecting emissions to a logger"],"tags":[]},{"location":"logging/to_logger/#python-logger","level":3,"title":"Python logger","text":"<pre><code>import logging\n\n# Create a dedicated logger (log name can be the CodeCarbon project name for example)\n_logger = logging.getLogger(log_name)\n\n# Add a handler, see Python logging for various handlers (here a local file named after log_name)\n_channel = logging.FileHandler(log_name + '.log')\n_logger.addHandler(_channel)\n\n# Set logging level from DEBUG to CRITICAL (typically INFO)\n# This level can be used in the logging process to filter emissions messages\n_logger.setLevel(logging.INFO)\n\n# Create a CodeCarbon LoggerOutput with the logger, specifying the logging level to be used for emissions data messages\nmy_logger = LoggerOutput(_logger, logging.INFO)\n</code></pre>","path":["Logging","Collecting emissions to a logger"],"tags":[]},{"location":"logging/to_logger/#google-cloud-logging","level":3,"title":"Google Cloud Logging","text":"<pre><code>import google.cloud.logging\n\n\n# Create a Cloud Logging client (specify project name if needed, otherwise Google SDK default project name is used)\nclient = google.cloud.logging.Client(project=google_project_name)\n\n# Create a CodeCarbon GoogleCloudLoggerOutput with the Cloud Logging logger, with the logging level to be used for emissions data messages\nmy_logger = GoogleCloudLoggerOutput(client.logger(log_name))\n</code></pre>","path":["Logging","Collecting emissions to a logger"],"tags":[]},{"location":"logging/to_logger/#authentication","level":3,"title":"Authentication","text":"<p>Please refer to Google Cloud documentation.</p>","path":["Logging","Collecting emissions to a logger"],"tags":[]},{"location":"logging/to_logger/#create-an-emissiontracker","level":3,"title":"Create an EmissionTracker","text":"<p>Create an EmissionTracker saving output to the logger. Other save options are still usable and valid.</p> <pre><code>tracker = EmissionsTracker(save_to_logger=True, logging_logger=my_logger)\ntracker.start()\n# Your code here\nemissions: float = tracker.stop()\n</code></pre>","path":["Logging","Collecting emissions to a logger"],"tags":[]},{"location":"logging/to_logger/#example","level":3,"title":"Example","text":"<p>A demonstration is available in <code>codecarbon/examples/logging_demo.py</code>.</p>","path":["Logging","Collecting emissions to a logger"],"tags":[]},{"location":"logging/visualize/","level":1,"title":"Visualize","text":"","path":["Logging","Visualize"],"tags":[]},{"location":"logging/visualize/#offline","level":2,"title":"Offline","text":"<p>The package also comes with a <code>Dash App</code> containing illustrations to understand the emissions logged from various experiments across projects. The App currently consumes logged information from a CSV file, generated from an in-built logger in the package.</p>","path":["Logging","Visualize"],"tags":[]},{"location":"logging/visualize/#installation","level":3,"title":"Installation","text":"<p>The carbonboard visualization tool requires additional dependencies. Install them with:</p> <pre><code>pip install 'codecarbon[carbonboard]'\n</code></pre> <p>Note</p> <p>The <code>viz-legacy</code> extra is deprecated but still works for backwards compatibility. It will be removed in v4.0.0. Please use <code>carbonboard</code> instead.</p>","path":["Logging","Visualize"],"tags":[]},{"location":"logging/visualize/#usage","level":3,"title":"Usage","text":"<p>The App can be run by executing the below CLI command that needs following arguments:</p> <ul> <li><code>filepath</code> - path to the CSV file containing logged information     across experiments and projects</li> <li><code>port</code> - an optional port number, in case default [8050] is used     by an existing process</li> </ul> <pre><code>carbonboard --filepath=\"examples/emissions.csv\" --port=3333\n</code></pre>","path":["Logging","Visualize"],"tags":[]},{"location":"logging/visualize/#summary-and-equivalents","level":3,"title":"Summary and Equivalents","text":"<p>Users can get an understanding of net power consumption and emissions generated across projects and can dive into a particular project. The App also provides exemplary equivalents from daily life, for example:</p> <ul> <li>Weekly Share of an average American household</li> <li>Number of miles driven</li> <li>Time of 32-inch LCD TV watched</li> </ul> <p></p>","path":["Logging","Visualize"],"tags":[]},{"location":"logging/visualize/#regional-comparisons","level":3,"title":"Regional Comparisons","text":"<p>The App also provides a comparative visual to benchmark emissions and energy mix of the electricity from the grid across different countries.</p> <p></p>","path":["Logging","Visualize"],"tags":[]},{"location":"logging/visualize/#cloud-regions","level":3,"title":"Cloud Regions","text":"<p>The App also benchmarks equivalent emissions across different regions of the cloud provider being used and recommends the most eco-friendly region to host infrastructure for the concerned cloud provider.</p> <p></p>","path":["Logging","Visualize"],"tags":[]},{"location":"logging/visualize/#online","level":2,"title":"Online","text":"<p>A dashboard is also available for those who chose to connect the package to the public API. Got to online dashboard</p>","path":["Logging","Visualize"],"tags":[]},{"location":"logging/visualize/#from-global","level":3,"title":"from global","text":"<p>Showing on the top the global energy consumed and emissions produced at an organisation level and the share of each project in this. The App also provides comparison points with daily life activity to get a better understanding of the amount generated.</p> <p></p>","path":["Logging","Visualize"],"tags":[]},{"location":"logging/visualize/#to-more-and-more","level":3,"title":"to more and more","text":"<p>Each project can be divided into several experiments, and in each experiment several runs can happen. The total emissions of experiments is shown on the barchart on the right hand side, and the runs on the bubble chart on the left hand side. If ever your project has several experiments you can switch from one experiment's runs in the bubble chart to another by clicking the bar chart.</p> <p></p>","path":["Logging","Visualize"],"tags":[]},{"location":"logging/visualize/#detailed","level":3,"title":"detailed","text":"<p>Clicking on one bubble, you can display the runtime series and see its metadata.</p> <p></p>","path":["Logging","Visualize"],"tags":[]},{"location":"logging/visualize/#electricity-production-carbon-intensity-per-country","level":3,"title":"Electricity production carbon intensity per country","text":"<p>The app also provides a visualization of regional carbon intensity of electricity production.</p> <p></p>","path":["Logging","Visualize"],"tags":[]}]}